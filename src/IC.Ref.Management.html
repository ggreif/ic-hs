<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLabels #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">{-|
This module implements the management canister logic of the Internet Computer.
-}</span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">IC.Ref.Management</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Management.html#invokeManagementCanister"><span class="hs-identifier">invokeManagementCanister</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.html"><span class="hs-identifier">Data.Row</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Variants.html"><span class="hs-identifier">Data.Row.Variants</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/bytestring-0.10.12.1/src/Data.ByteString.Lazy.html"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/5xj65cipwzdnpp6y5z9vwld366h065w2-vector-0.12.3.1-doc/share/doc/vector-0.12.3.1/html/src/Data.Vector.html"><span class="hs-identifier">Data.Vector</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Vec</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Numeric.Natural.html"><span class="hs-identifier">Numeric.Natural</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.State.Class.html"><span class="hs-identifier">Control.Monad.State.Class</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.Except.html"><span class="hs-identifier">Control.Monad.Except</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/b8ghyjizqjbnr6k9x8bbyvldavq0c2wf-MonadRandom-0.5.3-doc/share/doc/MonadRandom-0.5.3/html/src/Control.Monad.Random.Lazy.html"><span class="hs-identifier">Control.Monad.Random.Lazy</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.html"><span class="hs-identifier">Codec.Candid</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.html"><span class="hs-identifier">Data.Row</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator">(.==)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator">(.+)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator">(.!)</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator">(.!)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Types.html"><span class="hs-identifier">IC.Types</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Constants.html"><span class="hs-identifier">IC.Constants</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Canister.html"><span class="hs-identifier">IC.Canister</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Id.Fresh.html"><span class="hs-identifier">IC.Id.Fresh</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Management.html"><span class="hs-identifier">IC.Management</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Crypto.Bitcoin.html"><span class="hs-identifier">IC.Crypto.Bitcoin</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bitcoin</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Ref.HTTP.html"><span class="hs-identifier">IC.Ref.HTTP</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="IC.Ref.Types.html"><span class="hs-identifier">IC.Ref.Types</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="annot"><a href="IC.Ref.Management.html#invokeManagementCanister"><span class="hs-identifier hs-type">invokeManagementCanister</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679334827"><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Control.Monad.IO.Class.html#MonadIO"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="IC.Ref.Types.html#Subnet"><span class="hs-identifier hs-type">Subnet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CallId"><span class="hs-identifier hs-type">CallId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#EntryPoint"><span class="hs-identifier hs-type">EntryPoint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span id="invokeManagementCanister"><span class="annot"><span class="annottext">invokeManagementCanister :: forall (m :: * -&gt; *).
(CanReject m, ICM m, MonadIO m) =&gt;
EntityId -&gt; Maybe Subnet -&gt; CallId -&gt; EntryPoint -&gt; m ()
</span><a href="IC.Ref.Management.html#invokeManagementCanister"><span class="hs-identifier hs-var hs-var">invokeManagementCanister</span></a></span></span><span> </span><span id="local-6989586621679333066"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span id="local-6989586621679333065"><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span></span><span> </span><span id="local-6989586621679333064"><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679333064"><span class="hs-identifier hs-var">ctxt_id</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#Public"><span class="hs-identifier hs-type">Public</span></a></span><span> </span><span id="local-6989586621679333062"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span></span><span> </span><span id="local-6989586621679333061"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679333061"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-52"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;create_canister&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;settings&quot;
         ':-&gt; Maybe
                (Rec
                   ('R
                      '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                         &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                         &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                         &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
 -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;settings&quot;
          ':-&gt; Maybe
                 (Rec
                    ('R
                       '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                          &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                          &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                          &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
  -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;settings&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                            &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
    -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet
-&gt; (Rec
      ('R
         '[ &quot;settings&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                            &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
    -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
-&gt; Rec
     ('R
        '[ &quot;settings&quot;
           ':-&gt; Maybe
                  (Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                           &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                           &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                           &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
-&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]))
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
EntityId -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#noSubnet"><span class="hs-identifier hs-var">noSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;settings&quot;
          ':-&gt; Maybe
                 (Rec
                    ('R
                       '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                          &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                          &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                          &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
  -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
 -&gt; Rec
      ('R
         '[ &quot;settings&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                            &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
 -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
-&gt; (Rec
      ('R
         '[ &quot;settings&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                            &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
    -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
-&gt; Rec
     ('R
        '[ &quot;settings&quot;
           ':-&gt; Maybe
                  (Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                           &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                           &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                           &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
-&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet -&gt; CallId -&gt; ICManagement m .! &quot;create_canister&quot;
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId
-&gt; Maybe Subnet -&gt; CallId -&gt; ICManagement m .! &quot;create_canister&quot;
</span><a href="IC.Ref.Management.html#icCreateCanister"><span class="hs-identifier hs-var">icCreateCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679333064"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-53"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;install_code&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
         &quot;mode&quot;
         ':-&gt; Var
                ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
         &quot;wasm_module&quot; ':-&gt; ByteString])
 -&gt; m ())
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
          &quot;mode&quot;
          ':-&gt; Var
                 ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
          &quot;wasm_module&quot; ':-&gt; ByteString])
  -&gt; m ())
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
            &quot;mode&quot;
            ':-&gt; Var
                   ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
            &quot;wasm_module&quot; ':-&gt; ByteString])
    -&gt; m ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
-&gt; Bool
-&gt; EntityId
-&gt; (Rec
      ('R
         '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
            &quot;mode&quot;
            ':-&gt; Var
                   ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
            &quot;wasm_module&quot; ':-&gt; ByteString])
    -&gt; m ())
-&gt; Rec
     ('R
        '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
           &quot;mode&quot;
           ':-&gt; Var
                  ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
           &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; m ()
forall (m :: * -&gt; *) (r :: Row (*)) a.
(ICM m, CanReject m, (r .! &quot;canister_id&quot;) ~ Principal) =&gt;
MethodName -&gt; Bool -&gt; EntityId -&gt; (Rec r -&gt; m a) -&gt; Rec r -&gt; m a
</span><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-var">onlyControllerOrSelf</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
          &quot;mode&quot;
          ':-&gt; Var
                 ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
          &quot;wasm_module&quot; ':-&gt; ByteString])
  -&gt; m ())
 -&gt; Rec
      ('R
         '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
            &quot;mode&quot;
            ':-&gt; Var
                   ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
            &quot;wasm_module&quot; ':-&gt; ByteString])
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
            &quot;mode&quot;
            ':-&gt; Var
                   ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
            &quot;wasm_module&quot; ':-&gt; ByteString])
    -&gt; m ())
-&gt; Rec
     ('R
        '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
           &quot;mode&quot;
           ':-&gt; Var
                  ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
           &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
         &quot;mode&quot;
         ':-&gt; Var
                ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
         &quot;wasm_module&quot; ':-&gt; ByteString])
 -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec
      ('R
         '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
            &quot;mode&quot;
            ':-&gt; Var
                   ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
            &quot;wasm_module&quot; ':-&gt; ByteString])
    -&gt; m ())
-&gt; Rec
     ('R
        '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
           &quot;mode&quot;
           ':-&gt; Var
                  ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
           &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; m ()
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
          &quot;mode&quot;
          ':-&gt; Var
                 ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
          &quot;wasm_module&quot; ':-&gt; ByteString])
  -&gt; m ())
 -&gt; Rec
      ('R
         '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
            &quot;mode&quot;
            ':-&gt; Var
                   ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
            &quot;wasm_module&quot; ':-&gt; ByteString])
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
            &quot;mode&quot;
            ':-&gt; Var
                   ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
            &quot;wasm_module&quot; ':-&gt; ByteString])
    -&gt; m ())
-&gt; Rec
     ('R
        '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
           &quot;mode&quot;
           ':-&gt; Var
                  ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
           &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; ICManagement m .! &quot;install_code&quot;
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId -&gt; ICManagement m .! &quot;install_code&quot;
</span><a href="IC.Ref.Management.html#icInstallCode"><span class="hs-identifier hs-var">icInstallCode</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span>
</span><span id="line-54"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;uninstall_code&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
-&gt; Bool
-&gt; EntityId
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) (r :: Row (*)) a.
(ICM m, CanReject m, (r .! &quot;canister_id&quot;) ~ Principal) =&gt;
MethodName -&gt; Bool -&gt; EntityId -&gt; (Rec r -&gt; m a) -&gt; Rec r -&gt; m a
</span><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-var">onlyControllerOrSelf</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
 -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
 -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;uninstall_code&quot;
</span><a href="IC.Ref.Management.html#icUninstallCode"><span class="hs-identifier hs-var">icUninstallCode</span></a></span><span>
</span><span id="line-55"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;update_settings&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;canister_id&quot; ':-&gt; Principal,
         &quot;settings&quot;
         ':-&gt; Rec
                ('R
                   '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                      &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                      &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                      &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
 -&gt; m ())
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;canister_id&quot; ':-&gt; Principal,
          &quot;settings&quot;
          ':-&gt; Rec
                 ('R
                    '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                       &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                       &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                       &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
  -&gt; m ())
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Principal,
            &quot;settings&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                         &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                         &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                         &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
    -&gt; m ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
-&gt; Bool
-&gt; EntityId
-&gt; (Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Principal,
            &quot;settings&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                         &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                         &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                         &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
    -&gt; m ())
-&gt; Rec
     ('R
        '[ &quot;canister_id&quot; ':-&gt; Principal,
           &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
-&gt; m ()
forall (m :: * -&gt; *) (r :: Row (*)) a.
(ICM m, CanReject m, (r .! &quot;canister_id&quot;) ~ Principal) =&gt;
MethodName -&gt; Bool -&gt; EntityId -&gt; (Rec r -&gt; m a) -&gt; Rec r -&gt; m a
</span><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-var">onlyControllerOrSelf</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;canister_id&quot; ':-&gt; Principal,
          &quot;settings&quot;
          ':-&gt; Rec
                 ('R
                    '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                       &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                       &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                       &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
  -&gt; m ())
 -&gt; Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Principal,
            &quot;settings&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                         &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                         &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                         &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Principal,
            &quot;settings&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                         &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                         &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                         &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
    -&gt; m ())
-&gt; Rec
     ('R
        '[ &quot;canister_id&quot; ':-&gt; Principal,
           &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;canister_id&quot; ':-&gt; Principal,
         &quot;settings&quot;
         ':-&gt; Rec
                ('R
                   '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                      &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                      &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                      &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
 -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Principal,
            &quot;settings&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                         &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                         &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                         &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
    -&gt; m ())
-&gt; Rec
     ('R
        '[ &quot;canister_id&quot; ':-&gt; Principal,
           &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
-&gt; m ()
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
-&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
-&gt; m ()
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;update_settings&quot;
</span><a href="IC.Ref.Management.html#icUpdateCanisterSettings"><span class="hs-identifier hs-var">icUpdateCanisterSettings</span></a></span><span>
</span><span id="line-56"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;start_canister&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
-&gt; Bool
-&gt; EntityId
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) (r :: Row (*)) a.
(ICM m, CanReject m, (r .! &quot;canister_id&quot;) ~ Principal) =&gt;
MethodName -&gt; Bool -&gt; EntityId -&gt; (Rec r -&gt; m a) -&gt; Rec r -&gt; m a
</span><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-var">onlyControllerOrSelf</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
 -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;start_canister&quot;
</span><a href="IC.Ref.Management.html#icStartCanister"><span class="hs-identifier hs-var">icStartCanister</span></a></span><span>
</span><span id="line-57"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;stop_canister&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a. CandidArg a =&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="#local-6989586621679333050"><span class="hs-identifier hs-var">deferred</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
-&gt; Bool
-&gt; EntityId
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) (r :: Row (*)) a.
(ICM m, CanReject m, (r .! &quot;canister_id&quot;) ~ Principal) =&gt;
MethodName -&gt; Bool -&gt; EntityId -&gt; (Rec r -&gt; m a) -&gt; Rec r -&gt; m a
</span><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-var">onlyControllerOrSelf</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
 -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
 -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CallId -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()
forall (m :: * -&gt; *) a b.
(ICM m, CanReject m,
 (a -&gt; m b) ~ (ICManagement m .! &quot;stop_canister&quot;)) =&gt;
CallId -&gt; a -&gt; m ()
</span><a href="IC.Ref.Management.html#icStopCanister"><span class="hs-identifier hs-var">icStopCanister</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679333064"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;canister_status&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
 -&gt; m (Rec
         ('R
            '[ &quot;cycles&quot; ':-&gt; Natural,
               &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
               &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
               &quot;settings&quot;
               ':-&gt; Rec
                      ('R
                         '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                            &quot;controllers&quot; ':-&gt; Vector Principal,
                            &quot;freezing_threshold&quot; ':-&gt; Natural,
                            &quot;memory_allocation&quot; ':-&gt; Natural]),
               &quot;status&quot;
               ':-&gt; Var
                      ('R
                         '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
  -&gt; m (Rec
          ('R
             '[ &quot;cycles&quot; ':-&gt; Natural,
                &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
                &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
                &quot;settings&quot;
                ':-&gt; Rec
                       ('R
                          '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                             &quot;controllers&quot; ':-&gt; Vector Principal,
                             &quot;freezing_threshold&quot; ':-&gt; Natural,
                             &quot;memory_allocation&quot; ':-&gt; Natural]),
                &quot;status&quot;
                ':-&gt; Var
                       ('R
                          '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
 -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
    -&gt; m (Rec
            ('R
               '[ &quot;cycles&quot; ':-&gt; Natural,
                  &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
                  &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
                  &quot;settings&quot;
                  ':-&gt; Rec
                         ('R
                            '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                               &quot;controllers&quot; ':-&gt; Vector Principal,
                               &quot;freezing_threshold&quot; ':-&gt; Natural,
                               &quot;memory_allocation&quot; ':-&gt; Natural]),
                  &quot;status&quot;
                  ':-&gt; Var
                         ('R
                            '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
-&gt; Bool
-&gt; EntityId
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
    -&gt; m (Rec
            ('R
               '[ &quot;cycles&quot; ':-&gt; Natural,
                  &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
                  &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
                  &quot;settings&quot;
                  ':-&gt; Rec
                         ('R
                            '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                               &quot;controllers&quot; ':-&gt; Vector Principal,
                               &quot;freezing_threshold&quot; ':-&gt; Natural,
                               &quot;memory_allocation&quot; ':-&gt; Natural]),
                  &quot;status&quot;
                  ':-&gt; Var
                         ('R
                            '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m (Rec
        ('R
           '[ &quot;cycles&quot; ':-&gt; Natural,
              &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
              &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
              &quot;settings&quot;
              ':-&gt; Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                           &quot;controllers&quot; ':-&gt; Vector Principal,
                           &quot;freezing_threshold&quot; ':-&gt; Natural,
                           &quot;memory_allocation&quot; ':-&gt; Natural]),
              &quot;status&quot;
              ':-&gt; Var
                     ('R
                        '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]))
forall (m :: * -&gt; *) (r :: Row (*)) a.
(ICM m, CanReject m, (r .! &quot;canister_id&quot;) ~ Principal) =&gt;
MethodName -&gt; Bool -&gt; EntityId -&gt; (Rec r -&gt; m a) -&gt; Rec r -&gt; m a
</span><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-var">onlyControllerOrSelf</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
  -&gt; m (Rec
          ('R
             '[ &quot;cycles&quot; ':-&gt; Natural,
                &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
                &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
                &quot;settings&quot;
                ':-&gt; Rec
                       ('R
                          '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                             &quot;controllers&quot; ':-&gt; Vector Principal,
                             &quot;freezing_threshold&quot; ':-&gt; Natural,
                             &quot;memory_allocation&quot; ':-&gt; Natural]),
                &quot;status&quot;
                ':-&gt; Var
                       ('R
                          '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
 -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
 -&gt; m (Rec
         ('R
            '[ &quot;cycles&quot; ':-&gt; Natural,
               &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
               &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
               &quot;settings&quot;
               ':-&gt; Rec
                      ('R
                         '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                            &quot;controllers&quot; ':-&gt; Vector Principal,
                            &quot;freezing_threshold&quot; ':-&gt; Natural,
                            &quot;memory_allocation&quot; ':-&gt; Natural]),
               &quot;status&quot;
               ':-&gt; Var
                      ('R
                         '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
    -&gt; m (Rec
            ('R
               '[ &quot;cycles&quot; ':-&gt; Natural,
                  &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
                  &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
                  &quot;settings&quot;
                  ':-&gt; Rec
                         ('R
                            '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                               &quot;controllers&quot; ':-&gt; Vector Principal,
                               &quot;freezing_threshold&quot; ':-&gt; Natural,
                               &quot;memory_allocation&quot; ':-&gt; Natural]),
                  &quot;status&quot;
                  ':-&gt; Var
                         ('R
                            '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m (Rec
        ('R
           '[ &quot;cycles&quot; ':-&gt; Natural,
              &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
              &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
              &quot;settings&quot;
              ':-&gt; Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                           &quot;controllers&quot; ':-&gt; Vector Principal,
                           &quot;freezing_threshold&quot; ':-&gt; Natural,
                           &quot;memory_allocation&quot; ':-&gt; Natural]),
              &quot;status&quot;
              ':-&gt; Var
                     ('R
                        '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
    -&gt; m (Rec
            ('R
               '[ &quot;cycles&quot; ':-&gt; Natural,
                  &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
                  &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
                  &quot;settings&quot;
                  ':-&gt; Rec
                         ('R
                            '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                               &quot;controllers&quot; ':-&gt; Vector Principal,
                               &quot;freezing_threshold&quot; ':-&gt; Natural,
                               &quot;memory_allocation&quot; ':-&gt; Natural]),
                  &quot;status&quot;
                  ':-&gt; Var
                         ('R
                            '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m (Rec
        ('R
           '[ &quot;cycles&quot; ':-&gt; Natural,
              &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
              &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
              &quot;settings&quot;
              ':-&gt; Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                           &quot;controllers&quot; ':-&gt; Vector Principal,
                           &quot;freezing_threshold&quot; ':-&gt; Natural,
                           &quot;memory_allocation&quot; ':-&gt; Natural]),
              &quot;status&quot;
              ':-&gt; Var
                     ('R
                        '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]))
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m (Rec
        ('R
           '[ &quot;cycles&quot; ':-&gt; Natural,
              &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
              &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
              &quot;settings&quot;
              ':-&gt; Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                           &quot;controllers&quot; ':-&gt; Vector Principal,
                           &quot;freezing_threshold&quot; ':-&gt; Natural,
                           &quot;memory_allocation&quot; ':-&gt; Natural]),
              &quot;status&quot;
              ':-&gt; Var
                     ('R
                        '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]))
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;canister_status&quot;
</span><a href="IC.Ref.Management.html#icCanisterStatus"><span class="hs-identifier hs-var">icCanisterStatus</span></a></span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;delete_canister&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
-&gt; Bool
-&gt; EntityId
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) (r :: Row (*)) a.
(ICM m, CanReject m, (r .! &quot;canister_id&quot;) ~ Principal) =&gt;
MethodName -&gt; Bool -&gt; EntityId -&gt; (Rec r -&gt; m a) -&gt; Rec r -&gt; m a
</span><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-var">onlyControllerOrSelf</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
 -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;delete_canister&quot;
</span><a href="IC.Ref.Management.html#icDeleteCanister"><span class="hs-identifier hs-var">icDeleteCanister</span></a></span><span>
</span><span id="line-60"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;deposit_cycles&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
 -&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]) -&gt; m ())
-&gt; Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CallId -&gt; ICManagement m .! &quot;deposit_cycles&quot;
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
CallId -&gt; ICManagement m .! &quot;deposit_cycles&quot;
</span><a href="IC.Ref.Management.html#icDepositCycles"><span class="hs-identifier hs-var">icDepositCycles</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679333064"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-61"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;provisional_create_canister_with_cycles&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;amount&quot; ':-&gt; Maybe Natural,
         &quot;settings&quot;
         ':-&gt; Maybe
                (Rec
                   ('R
                      '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                         &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                         &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                         &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
         &quot;specified_id&quot; ':-&gt; Maybe Principal])
 -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;amount&quot; ':-&gt; Maybe Natural,
          &quot;settings&quot;
          ':-&gt; Maybe
                 (Rec
                    ('R
                       '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                          &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                          &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                          &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
          &quot;specified_id&quot; ':-&gt; Maybe Principal])
  -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;amount&quot; ':-&gt; Maybe Natural,
            &quot;settings&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                            &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
            &quot;specified_id&quot; ':-&gt; Maybe Principal])
    -&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet
-&gt; CallId
-&gt; ICManagement m .! &quot;provisional_create_canister_with_cycles&quot;
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId
-&gt; Maybe Subnet
-&gt; CallId
-&gt; ICManagement m .! &quot;provisional_create_canister_with_cycles&quot;
</span><a href="IC.Ref.Management.html#icCreateCanisterWithCycles"><span class="hs-identifier hs-var">icCreateCanisterWithCycles</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679333064"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-62"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;provisional_top_up_canister&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
 -&gt; m ())
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
  -&gt; m ())
 -&gt; m ())
-&gt; (Rec
      ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
    -&gt; m ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
 -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec
      ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
    -&gt; m ())
-&gt; Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
-&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var">fetchCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m ()
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;provisional_top_up_canister&quot;
</span><a href="IC.Ref.Management.html#icTopUpCanister"><span class="hs-identifier hs-var">icTopUpCanister</span></a></span><span>
</span><span id="line-63"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;raw_rand&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(() -&gt; m ByteString) -&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((() -&gt; m ByteString) -&gt; m ()) -&gt; (() -&gt; m ByteString) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet -&gt; (() -&gt; m ByteString) -&gt; () -&gt; m ByteString
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
EntityId -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#noSubnet"><span class="hs-identifier hs-var">noSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; m ByteString
forall (m :: * -&gt; *). ICM m =&gt; ICManagement m .! &quot;raw_rand&quot;
</span><a href="IC.Ref.Management.html#icRawRand"><span class="hs-identifier hs-var">icRawRand</span></a></span><span>
</span><span id="line-64"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;http_request&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;body&quot; ':-&gt; Maybe ByteString,
         &quot;headers&quot;
         ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
         &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
         &quot;method&quot;
         ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
         &quot;transform&quot;
         ':-&gt; Maybe
                (Rec
                   ('R
                      '[ &quot;context&quot; ':-&gt; ByteString,
                         &quot;function&quot;
                         ':-&gt; FuncRef
                                (Rec
                                   ('R
                                      '[ &quot;context&quot; ':-&gt; ByteString,
                                         &quot;response&quot;
                                         ':-&gt; Rec
                                                ('R
                                                   '[ &quot;body&quot; ':-&gt; ByteString,
                                                      &quot;headers&quot;
                                                      ':-&gt; Vector
                                                             (Rec
                                                                ('R
                                                                   '[ &quot;name&quot; ':-&gt; Text,
                                                                      &quot;value&quot; ':-&gt; Text])),
                                                      &quot;status&quot; ':-&gt; Natural])]),
                                 Rec
                                   ('R
                                      '[ &quot;body&quot; ':-&gt; ByteString,
                                         &quot;headers&quot;
                                         ':-&gt; Vector
                                                (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                         &quot;status&quot; ':-&gt; Natural]),
                                 AnnTrue, AnnFalse)])),
         &quot;url&quot; ':-&gt; Text])
 -&gt; m (Rec
         ('R
            '[ &quot;body&quot; ':-&gt; ByteString,
               &quot;headers&quot;
               ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
               &quot;status&quot; ':-&gt; Natural])))
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;body&quot; ':-&gt; Maybe ByteString,
          &quot;headers&quot;
          ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
          &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
          &quot;method&quot;
          ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
          &quot;transform&quot;
          ':-&gt; Maybe
                 (Rec
                    ('R
                       '[ &quot;context&quot; ':-&gt; ByteString,
                          &quot;function&quot;
                          ':-&gt; FuncRef
                                 (Rec
                                    ('R
                                       '[ &quot;context&quot; ':-&gt; ByteString,
                                          &quot;response&quot;
                                          ':-&gt; Rec
                                                 ('R
                                                    '[ &quot;body&quot; ':-&gt; ByteString,
                                                       &quot;headers&quot;
                                                       ':-&gt; Vector
                                                              (Rec
                                                                 ('R
                                                                    '[ &quot;name&quot; ':-&gt; Text,
                                                                       &quot;value&quot; ':-&gt; Text])),
                                                       &quot;status&quot; ':-&gt; Natural])]),
                                  Rec
                                    ('R
                                       '[ &quot;body&quot; ':-&gt; ByteString,
                                          &quot;headers&quot;
                                          ':-&gt; Vector
                                                 (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                          &quot;status&quot; ':-&gt; Natural]),
                                  AnnTrue, AnnFalse)])),
          &quot;url&quot; ':-&gt; Text])
  -&gt; m (Rec
          ('R
             '[ &quot;body&quot; ':-&gt; ByteString,
                &quot;headers&quot;
                ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                &quot;status&quot; ':-&gt; Natural])))
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;body&quot; ':-&gt; Maybe ByteString,
            &quot;headers&quot;
            ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
            &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
            &quot;method&quot;
            ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
            &quot;transform&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;context&quot; ':-&gt; ByteString,
                            &quot;function&quot;
                            ':-&gt; FuncRef
                                   (Rec
                                      ('R
                                         '[ &quot;context&quot; ':-&gt; ByteString,
                                            &quot;response&quot;
                                            ':-&gt; Rec
                                                   ('R
                                                      '[ &quot;body&quot; ':-&gt; ByteString,
                                                         &quot;headers&quot;
                                                         ':-&gt; Vector
                                                                (Rec
                                                                   ('R
                                                                      '[ &quot;name&quot; ':-&gt; Text,
                                                                         &quot;value&quot; ':-&gt; Text])),
                                                         &quot;status&quot; ':-&gt; Natural])]),
                                    Rec
                                      ('R
                                         '[ &quot;body&quot; ':-&gt; ByteString,
                                            &quot;headers&quot;
                                            ':-&gt; Vector
                                                   (Rec
                                                      ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                            &quot;status&quot; ':-&gt; Natural]),
                                    AnnTrue, AnnFalse)])),
            &quot;url&quot; ':-&gt; Text])
    -&gt; m (Rec
            ('R
               '[ &quot;body&quot; ':-&gt; ByteString,
                  &quot;headers&quot;
                  ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                  &quot;status&quot; ':-&gt; Natural])))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet
-&gt; (Rec
      ('R
         '[ &quot;body&quot; ':-&gt; Maybe ByteString,
            &quot;headers&quot;
            ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
            &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
            &quot;method&quot;
            ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
            &quot;transform&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;context&quot; ':-&gt; ByteString,
                            &quot;function&quot;
                            ':-&gt; FuncRef
                                   (Rec
                                      ('R
                                         '[ &quot;context&quot; ':-&gt; ByteString,
                                            &quot;response&quot;
                                            ':-&gt; Rec
                                                   ('R
                                                      '[ &quot;body&quot; ':-&gt; ByteString,
                                                         &quot;headers&quot;
                                                         ':-&gt; Vector
                                                                (Rec
                                                                   ('R
                                                                      '[ &quot;name&quot; ':-&gt; Text,
                                                                         &quot;value&quot; ':-&gt; Text])),
                                                         &quot;status&quot; ':-&gt; Natural])]),
                                    Rec
                                      ('R
                                         '[ &quot;body&quot; ':-&gt; ByteString,
                                            &quot;headers&quot;
                                            ':-&gt; Vector
                                                   (Rec
                                                      ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                            &quot;status&quot; ':-&gt; Natural]),
                                    AnnTrue, AnnFalse)])),
            &quot;url&quot; ':-&gt; Text])
    -&gt; m (Rec
            ('R
               '[ &quot;body&quot; ':-&gt; ByteString,
                  &quot;headers&quot;
                  ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                  &quot;status&quot; ':-&gt; Natural])))
-&gt; Rec
     ('R
        '[ &quot;body&quot; ':-&gt; Maybe ByteString,
           &quot;headers&quot;
           ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
           &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
           &quot;method&quot;
           ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
           &quot;transform&quot;
           ':-&gt; Maybe
                  (Rec
                     ('R
                        '[ &quot;context&quot; ':-&gt; ByteString,
                           &quot;function&quot;
                           ':-&gt; FuncRef
                                  (Rec
                                     ('R
                                        '[ &quot;context&quot; ':-&gt; ByteString,
                                           &quot;response&quot;
                                           ':-&gt; Rec
                                                  ('R
                                                     '[ &quot;body&quot; ':-&gt; ByteString,
                                                        &quot;headers&quot;
                                                        ':-&gt; Vector
                                                               (Rec
                                                                  ('R
                                                                     '[ &quot;name&quot; ':-&gt; Text,
                                                                        &quot;value&quot; ':-&gt; Text])),
                                                        &quot;status&quot; ':-&gt; Natural])]),
                                   Rec
                                     ('R
                                        '[ &quot;body&quot; ':-&gt; ByteString,
                                           &quot;headers&quot;
                                           ':-&gt; Vector
                                                  (Rec
                                                     ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                           &quot;status&quot; ':-&gt; Natural]),
                                   AnnTrue, AnnFalse)])),
           &quot;url&quot; ':-&gt; Text])
-&gt; m (Rec
        ('R
           '[ &quot;body&quot; ':-&gt; ByteString,
              &quot;headers&quot;
              ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
              &quot;status&quot; ':-&gt; Natural]))
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
EntityId -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#noSubnet"><span class="hs-identifier hs-var">noSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;body&quot; ':-&gt; Maybe ByteString,
          &quot;headers&quot;
          ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
          &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
          &quot;method&quot;
          ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
          &quot;transform&quot;
          ':-&gt; Maybe
                 (Rec
                    ('R
                       '[ &quot;context&quot; ':-&gt; ByteString,
                          &quot;function&quot;
                          ':-&gt; FuncRef
                                 (Rec
                                    ('R
                                       '[ &quot;context&quot; ':-&gt; ByteString,
                                          &quot;response&quot;
                                          ':-&gt; Rec
                                                 ('R
                                                    '[ &quot;body&quot; ':-&gt; ByteString,
                                                       &quot;headers&quot;
                                                       ':-&gt; Vector
                                                              (Rec
                                                                 ('R
                                                                    '[ &quot;name&quot; ':-&gt; Text,
                                                                       &quot;value&quot; ':-&gt; Text])),
                                                       &quot;status&quot; ':-&gt; Natural])]),
                                  Rec
                                    ('R
                                       '[ &quot;body&quot; ':-&gt; ByteString,
                                          &quot;headers&quot;
                                          ':-&gt; Vector
                                                 (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                          &quot;status&quot; ':-&gt; Natural]),
                                  AnnTrue, AnnFalse)])),
          &quot;url&quot; ':-&gt; Text])
  -&gt; m (Rec
          ('R
             '[ &quot;body&quot; ':-&gt; ByteString,
                &quot;headers&quot;
                ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                &quot;status&quot; ':-&gt; Natural])))
 -&gt; Rec
      ('R
         '[ &quot;body&quot; ':-&gt; Maybe ByteString,
            &quot;headers&quot;
            ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
            &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
            &quot;method&quot;
            ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
            &quot;transform&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;context&quot; ':-&gt; ByteString,
                            &quot;function&quot;
                            ':-&gt; FuncRef
                                   (Rec
                                      ('R
                                         '[ &quot;context&quot; ':-&gt; ByteString,
                                            &quot;response&quot;
                                            ':-&gt; Rec
                                                   ('R
                                                      '[ &quot;body&quot; ':-&gt; ByteString,
                                                         &quot;headers&quot;
                                                         ':-&gt; Vector
                                                                (Rec
                                                                   ('R
                                                                      '[ &quot;name&quot; ':-&gt; Text,
                                                                         &quot;value&quot; ':-&gt; Text])),
                                                         &quot;status&quot; ':-&gt; Natural])]),
                                    Rec
                                      ('R
                                         '[ &quot;body&quot; ':-&gt; ByteString,
                                            &quot;headers&quot;
                                            ':-&gt; Vector
                                                   (Rec
                                                      ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                            &quot;status&quot; ':-&gt; Natural]),
                                    AnnTrue, AnnFalse)])),
            &quot;url&quot; ':-&gt; Text])
 -&gt; m (Rec
         ('R
            '[ &quot;body&quot; ':-&gt; ByteString,
               &quot;headers&quot;
               ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
               &quot;status&quot; ':-&gt; Natural])))
-&gt; (Rec
      ('R
         '[ &quot;body&quot; ':-&gt; Maybe ByteString,
            &quot;headers&quot;
            ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
            &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
            &quot;method&quot;
            ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
            &quot;transform&quot;
            ':-&gt; Maybe
                   (Rec
                      ('R
                         '[ &quot;context&quot; ':-&gt; ByteString,
                            &quot;function&quot;
                            ':-&gt; FuncRef
                                   (Rec
                                      ('R
                                         '[ &quot;context&quot; ':-&gt; ByteString,
                                            &quot;response&quot;
                                            ':-&gt; Rec
                                                   ('R
                                                      '[ &quot;body&quot; ':-&gt; ByteString,
                                                         &quot;headers&quot;
                                                         ':-&gt; Vector
                                                                (Rec
                                                                   ('R
                                                                      '[ &quot;name&quot; ':-&gt; Text,
                                                                         &quot;value&quot; ':-&gt; Text])),
                                                         &quot;status&quot; ':-&gt; Natural])]),
                                    Rec
                                      ('R
                                         '[ &quot;body&quot; ':-&gt; ByteString,
                                            &quot;headers&quot;
                                            ':-&gt; Vector
                                                   (Rec
                                                      ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                            &quot;status&quot; ':-&gt; Natural]),
                                    AnnTrue, AnnFalse)])),
            &quot;url&quot; ':-&gt; Text])
    -&gt; m (Rec
            ('R
               '[ &quot;body&quot; ':-&gt; ByteString,
                  &quot;headers&quot;
                  ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                  &quot;status&quot; ':-&gt; Natural])))
-&gt; Rec
     ('R
        '[ &quot;body&quot; ':-&gt; Maybe ByteString,
           &quot;headers&quot;
           ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
           &quot;max_response_bytes&quot; ':-&gt; Maybe Word64,
           &quot;method&quot;
           ':-&gt; Var ('R '[ &quot;get&quot; ':-&gt; (), &quot;head&quot; ':-&gt; (), &quot;post&quot; ':-&gt; ()]),
           &quot;transform&quot;
           ':-&gt; Maybe
                  (Rec
                     ('R
                        '[ &quot;context&quot; ':-&gt; ByteString,
                           &quot;function&quot;
                           ':-&gt; FuncRef
                                  (Rec
                                     ('R
                                        '[ &quot;context&quot; ':-&gt; ByteString,
                                           &quot;response&quot;
                                           ':-&gt; Rec
                                                  ('R
                                                     '[ &quot;body&quot; ':-&gt; ByteString,
                                                        &quot;headers&quot;
                                                        ':-&gt; Vector
                                                               (Rec
                                                                  ('R
                                                                     '[ &quot;name&quot; ':-&gt; Text,
                                                                        &quot;value&quot; ':-&gt; Text])),
                                                        &quot;status&quot; ':-&gt; Natural])]),
                                   Rec
                                     ('R
                                        '[ &quot;body&quot; ':-&gt; ByteString,
                                           &quot;headers&quot;
                                           ':-&gt; Vector
                                                  (Rec
                                                     ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
                                           &quot;status&quot; ':-&gt; Natural]),
                                   AnnTrue, AnnFalse)])),
           &quot;url&quot; ':-&gt; Text])
-&gt; m (Rec
        ('R
           '[ &quot;body&quot; ':-&gt; ByteString,
              &quot;headers&quot;
              ':-&gt; Vector (Rec ('R '[ &quot;name&quot; ':-&gt; Text, &quot;value&quot; ':-&gt; Text])),
              &quot;status&quot; ':-&gt; Natural]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet -&gt; CallId -&gt; ICManagement m .! &quot;http_request&quot;
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId
-&gt; Maybe Subnet -&gt; CallId -&gt; ICManagement m .! &quot;http_request&quot;
</span><a href="IC.Ref.HTTP.html#icHttpRequest"><span class="hs-identifier hs-var">icHttpRequest</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679333064"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-65"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;ecdsa_public_key&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
         &quot;derivation_path&quot; ':-&gt; Vector ByteString,
         &quot;key_id&quot;
         ':-&gt; Rec
                ('R
                   '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                      &quot;name&quot; ':-&gt; Text])])
 -&gt; m (Rec
         ('R
            '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])))
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
          &quot;derivation_path&quot; ':-&gt; Vector ByteString,
          &quot;key_id&quot;
          ':-&gt; Rec
                 ('R
                    '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                       &quot;name&quot; ':-&gt; Text])])
  -&gt; m (Rec
          ('R
             '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])))
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
            &quot;derivation_path&quot; ':-&gt; Vector ByteString,
            &quot;key_id&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                         &quot;name&quot; ':-&gt; Text])])
    -&gt; m (Rec
            ('R
               '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
         &quot;derivation_path&quot; ':-&gt; Vector ByteString,
         &quot;key_id&quot;
         ':-&gt; Rec
                ('R
                   '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                      &quot;name&quot; ':-&gt; Text])])
 -&gt; EntityId)
-&gt; Maybe Subnet
-&gt; (Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
            &quot;derivation_path&quot; ':-&gt; Vector ByteString,
            &quot;key_id&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                         &quot;name&quot; ':-&gt; Text])])
    -&gt; m (Rec
            ('R
               '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])))
-&gt; Rec
     ('R
        '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
           &quot;derivation_path&quot; ':-&gt; Vector ByteString,
           &quot;key_id&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                        &quot;name&quot; ':-&gt; Text])])
-&gt; m (Rec
        ('R
           '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString]))
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityId
-&gt; Rec
     ('R
        '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
           &quot;derivation_path&quot; ':-&gt; Vector ByteString,
           &quot;key_id&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                        &quot;name&quot; ':-&gt; Text])])
-&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Maybe Principal) =&gt;
EntityId -&gt; Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterIdfromMaybe"><span class="hs-identifier hs-var">fetchCanisterIdfromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
          &quot;derivation_path&quot; ':-&gt; Vector ByteString,
          &quot;key_id&quot;
          ':-&gt; Rec
                 ('R
                    '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                       &quot;name&quot; ':-&gt; Text])])
  -&gt; m (Rec
          ('R
             '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])))
 -&gt; Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
            &quot;derivation_path&quot; ':-&gt; Vector ByteString,
            &quot;key_id&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                         &quot;name&quot; ':-&gt; Text])])
 -&gt; m (Rec
         ('R
            '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])))
-&gt; (Rec
      ('R
         '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
            &quot;derivation_path&quot; ':-&gt; Vector ByteString,
            &quot;key_id&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                         &quot;name&quot; ':-&gt; Text])])
    -&gt; m (Rec
            ('R
               '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])))
-&gt; Rec
     ('R
        '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
           &quot;derivation_path&quot; ':-&gt; Vector ByteString,
           &quot;key_id&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                        &quot;name&quot; ':-&gt; Text])])
-&gt; m (Rec
        ('R
           '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; ICManagement m .! &quot;ecdsa_public_key&quot;
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId -&gt; ICManagement m .! &quot;ecdsa_public_key&quot;
</span><a href="IC.Ref.Management.html#icEcdsaPublicKey"><span class="hs-identifier hs-var">icEcdsaPublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span>
</span><span id="line-66"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;sign_with_ecdsa&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
         &quot;key_id&quot;
         ':-&gt; Rec
                ('R
                   '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                      &quot;name&quot; ':-&gt; Text]),
         &quot;message_hash&quot; ':-&gt; ByteString])
 -&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])))
-&gt; m ()
forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var">atomic</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
          &quot;key_id&quot;
          ':-&gt; Rec
                 ('R
                    '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                       &quot;name&quot; ':-&gt; Text]),
          &quot;message_hash&quot; ':-&gt; ByteString])
  -&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])))
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
            &quot;key_id&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                         &quot;name&quot; ':-&gt; Text]),
            &quot;message_hash&quot; ':-&gt; ByteString])
    -&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])))
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet
-&gt; (Rec
      ('R
         '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
            &quot;key_id&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                         &quot;name&quot; ':-&gt; Text]),
            &quot;message_hash&quot; ':-&gt; ByteString])
    -&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])))
-&gt; Rec
     ('R
        '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
           &quot;key_id&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                        &quot;name&quot; ':-&gt; Text]),
           &quot;message_hash&quot; ':-&gt; ByteString])
-&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString]))
forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
EntityId -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#noSubnet"><span class="hs-identifier hs-var">noSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679333065"><span class="hs-identifier hs-var">maybeSubnet</span></a></span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
          &quot;key_id&quot;
          ':-&gt; Rec
                 ('R
                    '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                       &quot;name&quot; ':-&gt; Text]),
          &quot;message_hash&quot; ':-&gt; ByteString])
  -&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])))
 -&gt; Rec
      ('R
         '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
            &quot;key_id&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                         &quot;name&quot; ':-&gt; Text]),
            &quot;message_hash&quot; ':-&gt; ByteString])
 -&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])))
-&gt; (Rec
      ('R
         '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
            &quot;key_id&quot;
            ':-&gt; Rec
                   ('R
                      '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                         &quot;name&quot; ':-&gt; Text]),
            &quot;message_hash&quot; ':-&gt; ByteString])
    -&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])))
-&gt; Rec
     ('R
        '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
           &quot;key_id&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                        &quot;name&quot; ':-&gt; Text]),
           &quot;message_hash&quot; ':-&gt; ByteString])
-&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; ICManagement m .! &quot;sign_with_ecdsa&quot;
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId -&gt; ICManagement m .! &quot;sign_with_ecdsa&quot;
</span><a href="IC.Ref.Management.html#icSignWithEcdsa"><span class="hs-identifier hs-var">icSignWithEcdsa</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679333066"><span class="hs-identifier hs-var">caller</span></a></span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_DESTINATION_INVALID"><span class="hs-identifier hs-var">RC_DESTINATION_INVALID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Unsupported management function &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679333062"><span class="hs-identifier hs-var">method_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_METHOD_NOT_FOUND"><span class="hs-identifier hs-var">EC_METHOD_NOT_FOUND</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-comment">-- always responds</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="#local-6989586621679333060"><span class="hs-identifier hs-type">atomic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679334746"><span class="annot"><a href="#local-6989586621679334746"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679334745"><span class="annot"><a href="#local-6989586621679334745"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334746"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334745"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334746"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334745"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621679333060"><span class="annot"><span class="annottext">atomic :: forall a b. (CandidArg a, CandidArg b) =&gt; (a -&gt; m b) -&gt; m ()
</span><a href="#local-6989586621679333060"><span class="hs-identifier hs-var hs-var">atomic</span></a></span></span><span> </span><span id="local-6989586621679333023"><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679333023"><span class="hs-identifier hs-var">meth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((b -&gt; m ()) -&gt; a -&gt; m ())
-&gt; (ByteString -&gt; m ()) -&gt; ByteString -&gt; m ()
forall a b.
(CandidArg a, CandidArg b) =&gt;
((b -&gt; m ()) -&gt; a -&gt; m ())
-&gt; (ByteString -&gt; m ()) -&gt; ByteString -&gt; m ()
</span><a href="#local-6989586621679333022"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679333021"><span class="annot"><span class="annottext">b -&gt; m ()
</span><a href="#local-6989586621679333021"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679333020"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679333020"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m b
</span><a href="#local-6989586621679333023"><span class="hs-identifier hs-var">meth</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679333020"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">m b -&gt; (b -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; m ()
</span><a href="#local-6989586621679333021"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CallId -&gt; ByteString -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; ByteString -&gt; m ()
</span><a href="IC.Ref.Types.html#replyCallContext"><span class="hs-identifier hs-var">replyCallContext</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679333064"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679333061"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-comment">-- no implict reply</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><a href="#local-6989586621679333050"><span class="hs-identifier hs-type">deferred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679334726"><span class="annot"><a href="#local-6989586621679334726"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334726"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334726"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621679333050"><span class="annot"><span class="annottext">deferred :: forall a. CandidArg a =&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="#local-6989586621679333050"><span class="hs-identifier hs-var hs-var">deferred</span></a></span></span><span> </span><span id="local-6989586621679333011"><span class="annot"><span class="annottext">a -&gt; m ()
</span><a href="#local-6989586621679333011"><span class="hs-identifier hs-var">meth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b.
(CandidArg a, CandidArg b) =&gt;
((b -&gt; m ()) -&gt; a -&gt; m ())
-&gt; (ByteString -&gt; m ()) -&gt; ByteString -&gt; m ()
</span><a href="#local-6989586621679333022"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679334726"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679333010"><span class="annot"><span class="annottext">() -&gt; m ()
</span><a href="#local-6989586621679333010"><span class="hs-identifier hs-var">_k</span></a></span></span><span> </span><span id="local-6989586621679333009"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679333009"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; m ()
</span><a href="#local-6989586621679333011"><span class="hs-identifier hs-var">meth</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679333009"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName -&gt; ByteString -&gt; m ()
forall a. HasCallStack =&gt; MethodName -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;unused&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679333061"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="#local-6989586621679333022"><span class="hs-identifier hs-type">wrap</span></a></span><span>
</span><span id="line-78"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679334703"><span class="annot"><a href="#local-6989586621679334703"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679334702"><span class="annot"><a href="#local-6989586621679334702"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-79"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334703"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#CandidArg"><span class="hs-identifier hs-type">CandidArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334702"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-80"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334702"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334703"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="IC.Types.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#Blob"><span class="hs-identifier hs-type">Blob</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334827"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621679333022"><span class="annot"><span class="annottext">wrap :: forall a b.
(CandidArg a, CandidArg b) =&gt;
((b -&gt; m ()) -&gt; a -&gt; m ())
-&gt; (ByteString -&gt; m ()) -&gt; ByteString -&gt; m ()
</span><a href="#local-6989586621679333022"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621679332996"><span class="annot"><span class="annottext">(b -&gt; m ()) -&gt; a -&gt; m ()
</span><a href="#local-6989586621679332996"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span id="local-6989586621679332995"><span class="annot"><span class="annottext">ByteString -&gt; m ()
</span><a href="#local-6989586621679332995"><span class="hs-identifier hs-var">raw_reply</span></a></span></span><span> </span><span id="local-6989586621679332994"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679332994"><span class="hs-identifier hs-var">blob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-83"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall a. CandidArg a =&gt; ByteString -&gt; Either MethodName a
</span><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679334703"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679332994"><span class="hs-identifier hs-var">blob</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679332992"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332992"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Candid failed to decode: &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332992"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_INVALID_ENCODING"><span class="hs-identifier hs-var">EC_INVALID_ENCODING</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679332989"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679332989"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(b -&gt; m ()) -&gt; a -&gt; m ()
</span><a href="#local-6989586621679332996"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; m ()
</span><a href="#local-6989586621679332995"><span class="hs-identifier hs-var">raw_reply</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; m ()) -&gt; (b -&gt; ByteString) -&gt; b -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. CandidArg a =&gt; a -&gt; ByteString
</span><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679334702"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679332989"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="IC.Ref.Management.html#invokeManagementCanister"><span class="hs-identifier hs-var">invokeManagementCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CallId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="IC.Ref.Types.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; m ()
forall a. HasCallStack =&gt; MethodName -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;closure invoked on management canister&quot;</span></span><span>
</span><span id="line-88"></span><span class="annot"><a href="IC.Ref.Management.html#invokeManagementCanister"><span class="hs-identifier hs-var">invokeManagementCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CallId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EntryPoint
</span><a href="IC.Ref.Types.html#Heartbeat"><span class="hs-identifier hs-var">Heartbeat</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; m ()
forall a. HasCallStack =&gt; MethodName -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;heartbeat invoked on management canister&quot;</span></span><span>
</span><span id="line-89"></span><span class="annot"><a href="IC.Ref.Management.html#invokeManagementCanister"><span class="hs-identifier hs-var">invokeManagementCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CallId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EntryPoint
</span><a href="IC.Ref.Types.html#GlobalTimer"><span class="hs-identifier hs-var">GlobalTimer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; m ()
forall a. HasCallStack =&gt; MethodName -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;global timer invoked on management canister&quot;</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span id="local-6989586621679334738"><span class="annot"><a href="IC.Ref.Management.html#icCreateCanister"><span class="hs-identifier hs-type">icCreateCanister</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334738"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334738"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="IC.Ref.Types.html#Subnet"><span class="hs-identifier hs-type">Subnet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CallId"><span class="hs-identifier hs-type">CallId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334738"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;create_canister&quot;</span></span></span><span>
</span><span id="line-92"></span><span id="icCreateCanister"><span class="annot"><span class="annottext">icCreateCanister :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId
-&gt; Maybe Subnet -&gt; CallId -&gt; ICManagement m .! &quot;create_canister&quot;
</span><a href="IC.Ref.Management.html#icCreateCanister"><span class="hs-identifier hs-var hs-var">icCreateCanister</span></a></span></span><span> </span><span id="local-6989586621679332938"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332938"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span id="local-6989586621679332937"><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679332937"><span class="hs-identifier hs-var">maybe_subnet</span></a></span></span><span> </span><span id="local-6989586621679332936"><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332936"><span class="hs-identifier hs-var">ctxt_id</span></a></span></span><span> </span><span id="local-6989586621679332935"><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
</span><a href="#local-6989586621679332935"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (Rec
     ('R
        '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
           &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
           &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
           &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))
-&gt; (Rec
      ('R
         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
            &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
    -&gt; m ())
-&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
</span><a href="#local-6989586621679332935"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
-&gt; Label &quot;settings&quot;
-&gt; 'R
     '[ &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))]
   .! &quot;settings&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;settings&quot; (Label &quot;settings&quot;)
Label &quot;settings&quot;
</span><a href="#local-6989586621679332975"><span class="hs-var">#settings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; m ()
forall (m :: * -&gt; *). CanReject m =&gt; Settings -&gt; m ()
</span><a href="IC.Ref.Management.html#validateSettings"><span class="hs-identifier hs-var">validateSettings</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span id="local-6989586621679332932"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332932"><span class="hs-identifier hs-var">available</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CallId -&gt; m Natural
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; m Natural
</span><a href="IC.Ref.Types.html#getCallContextCycles"><span class="hs-identifier hs-var">getCallContextCycles</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332936"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">CallId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setCallContextCycles"><span class="hs-identifier hs-var">setCallContextCycles</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332936"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-96"></span><span>    </span><span id="local-6989586621679332929"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332929"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet
-&gt; Maybe EntityId
-&gt; EntityId
-&gt; Natural
-&gt; m EntityId
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId
-&gt; Maybe Subnet
-&gt; Maybe EntityId
-&gt; EntityId
-&gt; Natural
-&gt; m EntityId
</span><a href="IC.Ref.Management.html#icCreateCanisterCommon"><span class="hs-identifier hs-var">icCreateCanisterCommon</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332938"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679332937"><span class="hs-identifier hs-var">maybe_subnet</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EntityId
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332938"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332932"><span class="hs-identifier hs-var">available</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (Rec
     ('R
        '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
           &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
           &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
           &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))
-&gt; (Rec
      ('R
         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
            &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
    -&gt; m ())
-&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
</span><a href="#local-6989586621679332935"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))])
-&gt; Label &quot;settings&quot;
-&gt; 'R
     '[ &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))]
   .! &quot;settings&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;settings&quot; (Label &quot;settings&quot;)
Label &quot;settings&quot;
</span><a href="#local-6989586621679332952"><span class="hs-var">#settings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
          &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
          &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
          &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
  -&gt; m ())
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
            &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
    -&gt; m ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Settings -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Settings -&gt; m ()
</span><a href="IC.Ref.Management.html#applySettings"><span class="hs-identifier hs-var">applySettings</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332929"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332946"><span class="hs-var">#canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;canister_id&quot;
-&gt; Principal -&gt; Rec (Extend &quot;canister_id&quot; Principal ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Principal
</span><a href="IC.Management.html#entityIdToPrincipal"><span class="hs-identifier hs-var">entityIdToPrincipal</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332929"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span id="local-6989586621679334719"><span class="annot"><a href="IC.Ref.Management.html#icCreateCanisterWithCycles"><span class="hs-identifier hs-type">icCreateCanisterWithCycles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334719"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334719"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="IC.Ref.Types.html#Subnet"><span class="hs-identifier hs-type">Subnet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CallId"><span class="hs-identifier hs-type">CallId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334719"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;provisional_create_canister_with_cycles&quot;</span></span></span><span>
</span><span id="line-101"></span><span id="icCreateCanisterWithCycles"><span class="annot"><span class="annottext">icCreateCanisterWithCycles :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId
-&gt; Maybe Subnet
-&gt; CallId
-&gt; ICManagement m .! &quot;provisional_create_canister_with_cycles&quot;
</span><a href="IC.Ref.Management.html#icCreateCanisterWithCycles"><span class="hs-identifier hs-var hs-var">icCreateCanisterWithCycles</span></a></span></span><span> </span><span id="local-6989586621679332881"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332881"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span id="local-6989586621679332880"><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679332880"><span class="hs-identifier hs-var">maybe_subnet</span></a></span></span><span> </span><span id="local-6989586621679332879"><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332879"><span class="hs-identifier hs-var">ctxt_id</span></a></span></span><span> </span><span id="local-6989586621679332878"><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
</span><a href="#local-6989586621679332878"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (Rec
     ('R
        '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
           &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
           &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
           &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))
-&gt; (Rec
      ('R
         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
            &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
    -&gt; m ())
-&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
</span><a href="#local-6989586621679332878"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
-&gt; Label &quot;settings&quot;
-&gt; 'R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal]
   .! &quot;settings&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;settings&quot; (Label &quot;settings&quot;)
Label &quot;settings&quot;
</span><a href="#local-6989586621679332918"><span class="hs-var">#settings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; m ()
forall (m :: * -&gt; *). CanReject m =&gt; Settings -&gt; m ()
</span><a href="IC.Ref.Management.html#validateSettings"><span class="hs-identifier hs-var">validateSettings</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621679332877"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332877"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CallId -&gt; m EntityId
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; m EntityId
</span><a href="IC.Ref.Types.html#ecidOfCallID"><span class="hs-identifier hs-var">ecidOfCallID</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332879"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621679332875"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332875"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Maybe Subnet
-&gt; Maybe EntityId
-&gt; EntityId
-&gt; Natural
-&gt; m EntityId
forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId
-&gt; Maybe Subnet
-&gt; Maybe EntityId
-&gt; EntityId
-&gt; Natural
-&gt; m EntityId
</span><a href="IC.Ref.Management.html#icCreateCanisterCommon"><span class="hs-identifier hs-var">icCreateCanisterCommon</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332877"><span class="hs-identifier hs-var">ecid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679332880"><span class="hs-identifier hs-var">maybe_subnet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="annot"><span class="annottext">(Principal -&gt; EntityId) -&gt; Maybe Principal -&gt; Maybe EntityId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
</span><a href="#local-6989586621679332878"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
-&gt; Label &quot;specified_id&quot;
-&gt; 'R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal]
   .! &quot;specified_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;specified_id&quot; (Label &quot;specified_id&quot;)
Label &quot;specified_id&quot;
</span><a href="#local-6989586621679332902"><span class="hs-var">#specified_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332881"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Maybe Natural -&gt; Natural
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="IC.Constants.html#cDEFAULT_PROVISIONAL_CYCLES_BALANCE"><span class="hs-identifier hs-var">cDEFAULT_PROVISIONAL_CYCLES_BALANCE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
</span><a href="#local-6989586621679332878"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
-&gt; Label &quot;amount&quot;
-&gt; 'R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal]
   .! &quot;amount&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;amount&quot; (Label &quot;amount&quot;)
Label &quot;amount&quot;
</span><a href="#local-6989586621679332899"><span class="hs-var">#amount</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (Rec
     ('R
        '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
           &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
           &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
           &quot;memory_allocation&quot; ':-&gt; Maybe Natural]))
-&gt; (Rec
      ('R
         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
            &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
    -&gt; m ())
-&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
</span><a href="#local-6989586621679332878"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal])
-&gt; Label &quot;settings&quot;
-&gt; 'R
     '[ &quot;amount&quot; ':-&gt; Maybe Natural,
        &quot;settings&quot;
        ':-&gt; Maybe
               (Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])),
        &quot;specified_id&quot; ':-&gt; Maybe Principal]
   .! &quot;settings&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;settings&quot; (Label &quot;settings&quot;)
Label &quot;settings&quot;
</span><a href="#local-6989586621679332893"><span class="hs-var">#settings</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Rec
    ('R
       '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
          &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
          &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
          &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
  -&gt; m ())
 -&gt; m ())
-&gt; (Rec
      ('R
         '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
            &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
            &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
            &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
    -&gt; m ())
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Settings -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Settings -&gt; m ()
</span><a href="IC.Ref.Management.html#applySettings"><span class="hs-identifier hs-var">applySettings</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332875"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; m (Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332887"><span class="hs-var">#canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;canister_id&quot;
-&gt; Principal -&gt; Rec (Extend &quot;canister_id&quot; Principal ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Principal
</span><a href="IC.Management.html#entityIdToPrincipal"><span class="hs-identifier hs-var">entityIdToPrincipal</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332875"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span id="local-6989586621679334671"><span class="annot"><a href="IC.Ref.Management.html#icCreateCanisterCommon"><span class="hs-identifier hs-type">icCreateCanisterCommon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334671"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334671"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="IC.Ref.Types.html#Subnet"><span class="hs-identifier hs-type">Subnet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-bignum-1.1/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334671"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span></span><span>
</span><span id="line-109"></span><span id="icCreateCanisterCommon"><span class="annot"><span class="annottext">icCreateCanisterCommon :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId
-&gt; Maybe Subnet
-&gt; Maybe EntityId
-&gt; EntityId
-&gt; Natural
-&gt; m EntityId
</span><a href="IC.Ref.Management.html#icCreateCanisterCommon"><span class="hs-identifier hs-var hs-var">icCreateCanisterCommon</span></a></span></span><span> </span><span id="local-6989586621679332828"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332828"><span class="hs-identifier hs-var">ecid</span></a></span></span><span> </span><span id="local-6989586621679332827"><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679332827"><span class="hs-identifier hs-var">maybe_subnet</span></a></span></span><span> </span><span id="local-6989586621679332826"><span class="annot"><span class="annottext">Maybe EntityId
</span><a href="#local-6989586621679332826"><span class="hs-identifier hs-var">specified_id</span></a></span></span><span> </span><span id="local-6989586621679332825"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332825"><span class="hs-identifier hs-var">controller</span></a></span></span><span> </span><span id="local-6989586621679332824"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332824"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679332823"><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679332823"><span class="hs-identifier hs-var">ranges</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="#local-6989586621679332827"><span class="hs-identifier hs-var">maybe_subnet</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-111"></span><span>          </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubnetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679332822"><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679332822"><span class="hs-identifier hs-var">ranges</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Subnet
forall (m :: * -&gt; *). (CanReject m, ICM m) =&gt; EntityId -&gt; m Subnet
</span><a href="IC.Ref.Types.html#getSubnetFromCanisterId"><span class="hs-identifier hs-var">getSubnetFromCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332828"><span class="hs-identifier hs-var">ecid</span></a></span><span>
</span><span id="line-113"></span><span>            </span><span class="annot"><span class="annottext">[(Word64, Word64)] -&gt; m [(Word64, Word64)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679332822"><span class="hs-identifier hs-var">ranges</span></a></span><span>
</span><span id="line-114"></span><span>          </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityId
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubnetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679332820"><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679332820"><span class="hs-identifier hs-var">ranges</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)] -&gt; m [(Word64, Word64)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679332820"><span class="hs-identifier hs-var">ranges</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679332819"><span class="annot"><span class="annottext">[EntityId]
</span><a href="#local-6989586621679332819"><span class="hs-identifier hs-var">taken</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(IC -&gt; [EntityId]) -&gt; m [EntityId]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map EntityId CanState -&gt; [EntityId]
forall k a. Map k a -&gt; [k]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Map.Internal.html#keys"><span class="hs-identifier hs-var">M.keys</span></a></span><span> </span><span class="annot"><span class="annottext">(Map EntityId CanState -&gt; [EntityId])
-&gt; (IC -&gt; Map EntityId CanState) -&gt; IC -&gt; [EntityId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IC -&gt; Map EntityId CanState
</span><a href="IC.Ref.Types.html#canisters"><span class="hs-identifier hs-var hs-var">canisters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679332815"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332815"><span class="hs-identifier hs-var">new_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe EntityId
</span><a href="#local-6989586621679332826"><span class="hs-identifier hs-var">specified_id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>                </span><span class="annot"><span class="annottext">Maybe EntityId
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)] -&gt; [EntityId] -&gt; Maybe EntityId
</span><a href="IC.Id.Fresh.html#freshId"><span class="hs-identifier hs-var">freshId</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679332823"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityId]
</span><a href="#local-6989586621679332819"><span class="hs-identifier hs-var">taken</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-119"></span><span>                    </span><span class="annot"><span class="annottext">Maybe EntityId
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m EntityId
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_SYS_FATAL"><span class="hs-identifier hs-var">RC_SYS_FATAL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Could not create canister. Subnet has surpassed its canister ID allocation.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ErrorCode
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-120"></span><span>                    </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679332812"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332812"><span class="hs-identifier hs-var">new_id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m EntityId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332812"><span class="hs-identifier hs-var">new_id</span></a></span><span>
</span><span id="line-121"></span><span>                </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679332811"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332811"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332811"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; [EntityId] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityId]
</span><a href="#local-6989586621679332819"><span class="hs-identifier hs-var">taken</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-123"></span><span>                    </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_DESTINATION_INVALID"><span class="hs-identifier hs-var">RC_DESTINATION_INVALID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;The specified_id of the created canister is already in use.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ErrorCode
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-124"></span><span>                  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Word64, Word64)] -&gt; EntityId -&gt; Bool
</span><a href="IC.Id.Fresh.html#checkCanisterIdInRanges"><span class="hs-identifier hs-var">checkCanisterIdInRanges</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><a href="#local-6989586621679332823"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332811"><span class="hs-identifier hs-var">cid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-125"></span><span>                    </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_REJECT"><span class="hs-identifier hs-var">RC_CANISTER_REJECT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;The specified_id of the created canister does not belong to the subnet's canister ranges.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ErrorCode
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-126"></span><span>                  </span><span class="annot"><span class="annottext">EntityId -&gt; m EntityId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332811"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332803"><span class="annot"><span class="annottext">currentTime :: Timestamp
</span><a href="#local-6989586621679332803"><span class="hs-identifier hs-var hs-var">currentTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Timestamp
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- ic-ref lives in the 70ies</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; Set EntityId -&gt; Timestamp -&gt; m ()
forall (m :: * -&gt; *).
ICM m =&gt;
EntityId -&gt; Set EntityId -&gt; Timestamp -&gt; m ()
</span><a href="IC.Ref.Types.html#createEmptyCanister"><span class="hs-identifier hs-var">createEmptyCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332815"><span class="hs-identifier hs-var">new_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EntityId -&gt; Set EntityId
forall a. a -&gt; Set a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">S.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332825"><span class="hs-identifier hs-var">controller</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Timestamp
</span><a href="#local-6989586621679332803"><span class="hs-identifier hs-var">currentTime</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">-- Here we fill up the canister with the cycles provided by the caller</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setBalance"><span class="hs-identifier hs-var">setBalance</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332815"><span class="hs-identifier hs-var">new_id</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332824"><span class="hs-identifier hs-var">amount</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m EntityId
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332815"><span class="hs-identifier hs-var">new_id</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span id="local-6989586621679334675"><span class="annot"><a href="IC.Ref.Management.html#validateSettings"><span class="hs-identifier hs-type">validateSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334675"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#Settings"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334675"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-134"></span><span id="validateSettings"><span class="annot"><span class="annottext">validateSettings :: forall (m :: * -&gt; *). CanReject m =&gt; Settings -&gt; m ()
</span><a href="IC.Ref.Management.html#validateSettings"><span class="hs-identifier hs-var hs-var">validateSettings</span></a></span></span><span> </span><span id="local-6989586621679332747"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679332747"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">Maybe Natural -&gt; (Natural -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
Settings
</span><a href="#local-6989586621679332747"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; Label &quot;compute_allocation&quot;
-&gt; 'R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]
   .! &quot;compute_allocation&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;compute_allocation&quot; (Label &quot;compute_allocation&quot;)
Label &quot;compute_allocation&quot;
</span><a href="#local-6989586621679332793"><span class="hs-var">#compute_allocation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; m ()) -&gt; m ()) -&gt; (Natural -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679332746"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332746"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332746"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">100</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-137"></span><span>            </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Compute allocation not &lt;= 100&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_CONTRACT_VIOLATION"><span class="hs-identifier hs-var">EC_CANISTER_CONTRACT_VIOLATION</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="annottext">Maybe Natural -&gt; (Natural -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
Settings
</span><a href="#local-6989586621679332747"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; Label &quot;memory_allocation&quot;
-&gt; 'R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]
   .! &quot;memory_allocation&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;memory_allocation&quot; (Label &quot;memory_allocation&quot;)
Label &quot;memory_allocation&quot;
</span><a href="#local-6989586621679332781"><span class="hs-var">#memory_allocation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; m ()) -&gt; m ()) -&gt; (Natural -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679332743"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332743"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332743"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Natural -&gt; CallId -&gt; Natural
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">CallId
</span><span class="hs-number">48</span></span><span class="hs-glyph">::</span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-140"></span><span>            </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Memory allocation not &lt;= 2^48&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_CONTRACT_VIOLATION"><span class="hs-identifier hs-var">EC_CANISTER_CONTRACT_VIOLATION</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">Maybe Natural -&gt; (Natural -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
Settings
</span><a href="#local-6989586621679332747"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; Label &quot;freezing_threshold&quot;
-&gt; 'R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]
   .! &quot;freezing_threshold&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;freezing_threshold&quot; (Label &quot;freezing_threshold&quot;)
Label &quot;freezing_threshold&quot;
</span><a href="#local-6989586621679332768"><span class="hs-var">#freezing_threshold</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; m ()) -&gt; m ()) -&gt; (Natural -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679332741"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332741"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679332741"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3C"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Natural -&gt; CallId -&gt; Natural
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Real.html#%5E"><span class="hs-operator hs-var">^</span></a></span><span class="hs-special">(</span><span class="annot"><span class="annottext">CallId
</span><span class="hs-number">64</span></span><span class="hs-glyph">::</span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-143"></span><span>            </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Freezing threshold not &lt; 2^64&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_CONTRACT_VIOLATION"><span class="hs-identifier hs-var">EC_CANISTER_CONTRACT_VIOLATION</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Vector Principal) -&gt; (Vector Principal -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
Settings
</span><a href="#local-6989586621679332747"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; Label &quot;controllers&quot;
-&gt; 'R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]
   .! &quot;controllers&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;controllers&quot; (Label &quot;controllers&quot;)
Label &quot;controllers&quot;
</span><a href="#local-6989586621679332757"><span class="hs-var">#controllers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Vector Principal -&gt; m ()) -&gt; m ())
-&gt; (Vector Principal -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679332739"><span class="annot"><span class="annottext">Vector Principal
</span><a href="#local-6989586621679332739"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Vector Principal -&gt; CallId
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; CallId
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Principal
</span><a href="#local-6989586621679332739"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">CallId -&gt; CallId -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-146"></span><span>            </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Controllers cannot be &gt; 10&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_CONTRACT_VIOLATION"><span class="hs-identifier hs-var">EC_CANISTER_CONTRACT_VIOLATION</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span id="local-6989586621679334670"><span class="annot"><a href="IC.Ref.Management.html#applySettings"><span class="hs-identifier hs-type">applySettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334670"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#Settings"><span class="hs-identifier hs-type">Settings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334670"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-149"></span><span id="applySettings"><span class="annot"><span class="annottext">applySettings :: forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Settings -&gt; m ()
</span><a href="IC.Ref.Management.html#applySettings"><span class="hs-identifier hs-var hs-var">applySettings</span></a></span></span><span> </span><span id="local-6989586621679332694"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332694"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679332693"><span class="annot"><span class="annottext">Settings
</span><a href="#local-6989586621679332693"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Vector Principal) -&gt; (Vector Principal -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
Settings
</span><a href="#local-6989586621679332693"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; Label &quot;controllers&quot;
-&gt; 'R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]
   .! &quot;controllers&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;controllers&quot; (Label &quot;controllers&quot;)
Label &quot;controllers&quot;
</span><a href="#local-6989586621679332731"><span class="hs-var">#controllers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Vector Principal -&gt; m ()) -&gt; m ())
-&gt; (Vector Principal -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Set EntityId -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Set EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#setControllers"><span class="hs-identifier hs-var">setControllers</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332694"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">(Set EntityId -&gt; m ())
-&gt; (Vector Principal -&gt; Set EntityId) -&gt; Vector Principal -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[EntityId] -&gt; Set EntityId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([EntityId] -&gt; Set EntityId)
-&gt; (Vector Principal -&gt; [EntityId])
-&gt; Vector Principal
-&gt; Set EntityId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Principal -&gt; EntityId) -&gt; [Principal] -&gt; [EntityId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="annot"><span class="annottext">([Principal] -&gt; [EntityId])
-&gt; (Vector Principal -&gt; [Principal])
-&gt; Vector Principal
-&gt; [EntityId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Vector Principal -&gt; [Principal]
forall a. Vector a -&gt; [a]
</span><a href="file:///nix/store/5xj65cipwzdnpp6y5z9vwld366h065w2-vector-0.12.3.1-doc/share/doc/vector-0.12.3.1/html/src/Data.Vector.html#toList"><span class="hs-identifier hs-var">Vec.toList</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">Maybe Natural -&gt; (Natural -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
Settings
</span><a href="#local-6989586621679332693"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; Label &quot;compute_allocation&quot;
-&gt; 'R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]
   .! &quot;compute_allocation&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;compute_allocation&quot; (Label &quot;compute_allocation&quot;)
Label &quot;compute_allocation&quot;
</span><a href="#local-6989586621679332718"><span class="hs-var">#compute_allocation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; m ()) -&gt; m ()) -&gt; (Natural -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setComputeAllocation"><span class="hs-identifier hs-var">setComputeAllocation</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332694"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">Maybe Natural -&gt; (Natural -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
Settings
</span><a href="#local-6989586621679332693"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; Label &quot;memory_allocation&quot;
-&gt; 'R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]
   .! &quot;memory_allocation&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;memory_allocation&quot; (Label &quot;memory_allocation&quot;)
Label &quot;memory_allocation&quot;
</span><a href="#local-6989586621679332710"><span class="hs-var">#memory_allocation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; m ()) -&gt; m ()) -&gt; (Natural -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setMemoryAllocation"><span class="hs-identifier hs-var">setMemoryAllocation</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332694"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="annottext">Maybe Natural -&gt; (Natural -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
Settings
</span><a href="#local-6989586621679332693"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural])
-&gt; Label &quot;freezing_threshold&quot;
-&gt; 'R
     '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
        &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
        &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
        &quot;memory_allocation&quot; ':-&gt; Maybe Natural]
   .! &quot;freezing_threshold&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;freezing_threshold&quot; (Label &quot;freezing_threshold&quot;)
Label &quot;freezing_threshold&quot;
</span><a href="#local-6989586621679332703"><span class="hs-var">#freezing_threshold</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; m ()) -&gt; m ()) -&gt; (Natural -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setFreezingThreshold"><span class="hs-identifier hs-var">setFreezingThreshold</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332694"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span id="local-6989586621679334735"><span id="local-6989586621679334736"><span id="local-6989586621679334737"><span class="annot"><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-type">onlyControllerOrSelf</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334737"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334737"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334736"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;canister_id&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Data.html#Principal"><span class="hs-identifier hs-type">Principal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#Rec"><span class="hs-identifier hs-type">R.Rec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334736"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334737"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334735"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#Rec"><span class="hs-identifier hs-type">R.Rec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334736"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334737"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334735"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-158"></span><span id="onlyControllerOrSelf"><span class="annot"><span class="annottext">onlyControllerOrSelf :: forall (m :: * -&gt; *) (r :: Row (*)) a.
(ICM m, CanReject m, (r .! &quot;canister_id&quot;) ~ Principal) =&gt;
MethodName -&gt; Bool -&gt; EntityId -&gt; (Rec r -&gt; m a) -&gt; Rec r -&gt; m a
</span><a href="IC.Ref.Management.html#onlyControllerOrSelf"><span class="hs-identifier hs-var hs-var">onlyControllerOrSelf</span></a></span></span><span> </span><span id="local-6989586621679332650"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332650"><span class="hs-identifier hs-var">method_name</span></a></span></span><span> </span><span id="local-6989586621679332649"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679332649"><span class="hs-identifier hs-var">self</span></a></span></span><span> </span><span id="local-6989586621679332648"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332648"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span id="local-6989586621679332647"><span class="annot"><span class="annottext">Rec r -&gt; m a
</span><a href="#local-6989586621679332647"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679332646"><span class="annot"><span class="annottext">Rec r
</span><a href="#local-6989586621679332646"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332645"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679332645"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec r
</span><a href="#local-6989586621679332646"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec r -&gt; Label &quot;canister_id&quot; -&gt; r .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332682"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m ()
forall (m :: * -&gt; *). (CanReject m, ICM m) =&gt; EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#canisterMustExist"><span class="hs-identifier hs-var">canisterMustExist</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332645"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679332643"><span class="annot"><span class="annottext">Set EntityId
</span><a href="#local-6989586621679332643"><span class="hs-identifier hs-var">controllers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m (Set EntityId)
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m (Set EntityId)
</span><a href="IC.Ref.Types.html#getControllers"><span class="hs-identifier hs-var">getControllers</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332645"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332641"><span class="annot"><span class="annottext">allowed :: Set EntityId
</span><a href="#local-6989586621679332641"><span class="hs-identifier hs-var hs-var">allowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679332649"><span class="hs-identifier hs-var">self</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Set EntityId -&gt; Set EntityId
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332645"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">Set EntityId
</span><a href="#local-6989586621679332643"><span class="hs-identifier hs-var">controllers</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Set EntityId
</span><a href="#local-6989586621679332643"><span class="hs-identifier hs-var">controllers</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332648"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Set EntityId -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`S.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set EntityId
</span><a href="#local-6989586621679332641"><span class="hs-identifier hs-var">allowed</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Rec r -&gt; m a
</span><a href="#local-6989586621679332647"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">Rec r
</span><a href="#local-6989586621679332646"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; MethodName
</span><a href="IC.Types.html#prettyID"><span class="hs-identifier hs-var">prettyID</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332648"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot; is not authorized to call &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332650"><span class="hs-identifier hs-var">method_name</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot; on canister &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-167"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; MethodName
</span><a href="IC.Types.html#prettyID"><span class="hs-identifier hs-var">prettyID</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332645"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;, Allowed principals are: &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; [MethodName] -&gt; MethodName
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.OldList.html#intercalate"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EntityId -&gt; MethodName) -&gt; [EntityId] -&gt; [MethodName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; MethodName
</span><a href="IC.Types.html#prettyID"><span class="hs-identifier hs-var">prettyID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set EntityId -&gt; [EntityId]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set EntityId
</span><a href="#local-6989586621679332641"><span class="hs-identifier hs-var">allowed</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_NOT_AUTHORIZED"><span class="hs-identifier hs-var">EC_NOT_AUTHORIZED</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="local-6989586621679334715"><span class="annot"><a href="IC.Ref.Management.html#fetchCanisterIdfromMaybe"><span class="hs-identifier hs-type">fetchCanisterIdfromMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334715"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;canister_id&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Data.html#Principal"><span class="hs-identifier hs-type">Principal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#Rec"><span class="hs-identifier hs-type">R.Rec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334715"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span></span><span>
</span><span id="line-173"></span><span id="fetchCanisterIdfromMaybe"><span class="annot"><span class="annottext">fetchCanisterIdfromMaybe :: forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Maybe Principal) =&gt;
EntityId -&gt; Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterIdfromMaybe"><span class="hs-identifier hs-var hs-var">fetchCanisterIdfromMaybe</span></a></span></span><span> </span><span id="local-6989586621679332627"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332627"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621679332626"><span class="annot"><span class="annottext">Rec r
</span><a href="#local-6989586621679332626"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Rec r
</span><a href="#local-6989586621679332626"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec r -&gt; Label &quot;canister_id&quot; -&gt; r .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332632"><span class="hs-var">#canister_id</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Maybe Principal
r .! &quot;canister_id&quot;
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332627"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-175"></span><span>                            </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679332625"><span class="annot"><span class="annottext">Principal
</span><a href="#local-6989586621679332625"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="annot"><span class="annottext">Principal
</span><a href="#local-6989586621679332625"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span id="local-6989586621679334731"><span class="annot"><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-type">fetchCanisterId</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334731"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;canister_id&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Data.html#Principal"><span class="hs-identifier hs-type">Principal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#Rec"><span class="hs-identifier hs-type">R.Rec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334731"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span></span><span>
</span><span id="line-180"></span><span id="fetchCanisterId"><span class="annot"><span class="annottext">fetchCanisterId :: forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Principal) =&gt;
Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterId"><span class="hs-identifier hs-var hs-var">fetchCanisterId</span></a></span></span><span> </span><span id="local-6989586621679332617"><span class="annot"><span class="annottext">Rec r
</span><a href="#local-6989586621679332617"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec r
</span><a href="#local-6989586621679332617"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec r -&gt; Label &quot;canister_id&quot; -&gt; r .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332622"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span id="local-6989586621679334732"><span id="local-6989586621679334733"><span id="local-6989586621679334734"><span class="annot"><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-type">checkSubnet</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334733"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="IC.Ref.Types.html#Subnet"><span class="hs-identifier hs-type">Subnet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334733"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334734"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334732"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334733"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334734"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334732"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-185"></span><span id="checkSubnet"><span class="annot"><span class="annottext">checkSubnet :: forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
(r -&gt; EntityId) -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var hs-var">checkSubnet</span></a></span></span><span> </span><span class="annot"><span class="annottext">r -&gt; EntityId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621679332593"><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679332593"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679332592"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332592"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679332593"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332592"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-186"></span><span class="annot"><a href="IC.Ref.Management.html#checkSubnet"><span class="hs-identifier hs-var">checkSubnet</span></a></span><span> </span><span id="local-6989586621679332591"><span class="annot"><span class="annottext">r -&gt; EntityId
</span><a href="#local-6989586621679332591"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679332590"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332590"><span class="hs-identifier hs-var">subnet_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubnetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679332589"><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679332589"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679332588"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332588"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332587"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679332587"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; EntityId
</span><a href="#local-6989586621679332591"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332588"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m ()
forall (m :: * -&gt; *). (CanReject m, ICM m) =&gt; EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#canisterMustExist"><span class="hs-identifier hs-var">canisterMustExist</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332587"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679332586"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332586"><span class="hs-identifier hs-var">subnet_id'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubnetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Subnet
forall (m :: * -&gt; *). (CanReject m, ICM m) =&gt; EntityId -&gt; m Subnet
</span><a href="IC.Ref.Types.html#getSubnetFromCanisterId"><span class="hs-identifier hs-var">getSubnetFromCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332587"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332590"><span class="hs-identifier hs-var">subnet_id</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; EntityId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332586"><span class="hs-identifier hs-var">subnet_id'</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679332589"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332588"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_DESTINATION_INVALID"><span class="hs-identifier hs-var">RC_DESTINATION_INVALID</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; MethodName
</span><a href="IC.Types.html#prettyID"><span class="hs-identifier hs-var">prettyID</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332587"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot; does not belong to subnet &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; MethodName
</span><a href="IC.Types.html#prettyID"><span class="hs-identifier hs-var">prettyID</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332590"><span class="hs-identifier hs-var">subnet_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_INVALID_ARGUMENT"><span class="hs-identifier hs-var">EC_INVALID_ARGUMENT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span id="local-6989586621679334739"><span id="local-6989586621679334740"><span id="local-6989586621679334741"><span class="annot"><a href="IC.Ref.Management.html#noSubnet"><span class="hs-identifier hs-type">noSubnet</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="IC.Ref.Types.html#Subnet"><span class="hs-identifier hs-type">Subnet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334740"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334741"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334739"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334740"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334741"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334739"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-200"></span><span id="noSubnet"><span class="annot"><span class="annottext">noSubnet :: forall (m :: * -&gt; *) r a.
(ICM m, CanReject m) =&gt;
EntityId -&gt; Maybe Subnet -&gt; (r -&gt; m a) -&gt; r -&gt; m a
</span><a href="IC.Ref.Management.html#noSubnet"><span class="hs-identifier hs-var hs-var">noSubnet</span></a></span></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Subnet
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621679332565"><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679332565"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679332564"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332564"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679332565"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332564"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-201"></span><span class="annot"><a href="IC.Ref.Management.html#noSubnet"><span class="hs-identifier hs-var">noSubnet</span></a></span><span> </span><span id="local-6989586621679332563"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332563"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679332562"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332562"><span class="hs-identifier hs-var">subnet_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubnetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679332561"><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679332561"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679332560"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332560"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621679332559"><span class="annot"><span class="annottext">Maybe EntityId
</span><a href="#local-6989586621679332559"><span class="hs-identifier hs-var">root_subnet_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(IC -&gt; Maybe EntityId) -&gt; m (Maybe EntityId)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">IC -&gt; Maybe EntityId
</span><a href="IC.Ref.Types.html#rootSubnet"><span class="hs-identifier hs-var hs-var">rootSubnet</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679332557"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332557"><span class="hs-identifier hs-var">caller_subnet_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SubnetType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SecretKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Word64, Word64)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Subnet
forall (m :: * -&gt; *). (CanReject m, ICM m) =&gt; EntityId -&gt; m Subnet
</span><a href="IC.Ref.Types.html#getSubnetFromCanisterId"><span class="hs-identifier hs-var">getSubnetFromCanisterId</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332563"><span class="hs-identifier hs-var">caller</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe EntityId
</span><a href="#local-6989586621679332559"><span class="hs-identifier hs-var">root_subnet_id</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EntityId -&gt; Maybe EntityId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Maybe EntityId
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332557"><span class="hs-identifier hs-var">caller_subnet_id</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%7C%7C"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332562"><span class="hs-identifier hs-var">subnet_id</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; EntityId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332557"><span class="hs-identifier hs-var">caller_subnet_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><span class="annottext">r -&gt; m a
</span><a href="#local-6989586621679332561"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679332560"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;the caller must be on the root subnet or belong to the target subnet&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_INVALID_ARGUMENT"><span class="hs-identifier hs-var">EC_INVALID_ARGUMENT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span id="local-6989586621679334730"><span class="annot"><a href="IC.Ref.Management.html#icInstallCode"><span class="hs-identifier hs-type">icInstallCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334730"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334730"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334730"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;install_code&quot;</span></span></span><span>
</span><span id="line-210"></span><span id="icInstallCode"><span class="annot"><span class="annottext">icInstallCode :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId -&gt; ICManagement m .! &quot;install_code&quot;
</span><a href="IC.Ref.Management.html#icInstallCode"><span class="hs-identifier hs-var hs-var">icInstallCode</span></a></span></span><span> </span><span id="local-6989586621679332344"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332344"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span id="local-6989586621679332343"><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
</span><a href="#local-6989586621679332343"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332342"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
</span><a href="#local-6989586621679332343"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString]
   .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332552"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332341"><span class="annot"><span class="annottext">arg :: 'R
  '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
     &quot;mode&quot;
     ':-&gt; Var
            ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
     &quot;wasm_module&quot; ':-&gt; ByteString]
.! &quot;arg&quot;
</span><a href="#local-6989586621679332341"><span class="hs-identifier hs-var hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
</span><a href="#local-6989586621679332343"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; Label &quot;arg&quot;
-&gt; 'R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString]
   .! &quot;arg&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;arg&quot; (Label &quot;arg&quot;)
Label &quot;arg&quot;
</span><a href="#local-6989586621679332549"><span class="hs-var">#arg</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679332340"><span class="annot"><span class="annottext">CanisterModule
</span><a href="#local-6989586621679332340"><span class="hs-identifier hs-var">new_can_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either MethodName CanisterModule
-&gt; m (Either MethodName CanisterModule)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Either MethodName CanisterModule
</span><a href="IC.Canister.html#parseCanister"><span class="hs-identifier hs-var">parseCanister</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
</span><a href="#local-6989586621679332343"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; Label &quot;wasm_module&quot;
-&gt; 'R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString]
   .! &quot;wasm_module&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;wasm_module&quot; (Label &quot;wasm_module&quot;)
Label &quot;wasm_module&quot;
</span><a href="#local-6989586621679332542"><span class="hs-var">#wasm_module</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>      </span><span class="annot"><span class="annottext">m (Either MethodName CanisterModule)
-&gt; (MethodName -&gt; m CanisterModule) -&gt; m CanisterModule
forall (m :: * -&gt; *) a b.
Monad m =&gt;
m (Either a b) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="IC.Ref.Types.html#onErr"><span class="hs-operator hs-var">`onErr`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679332337"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332337"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m CanisterModule
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Parsing failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332337"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_INVALID_MODULE"><span class="hs-identifier hs-var">EC_INVALID_MODULE</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679332335"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679332335"><span class="hs-identifier hs-var">was_empty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Bool
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m Bool
</span><a href="IC.Ref.Types.html#isCanisterEmpty"><span class="hs-identifier hs-var">isCanisterEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-218"></span><span>      </span><span id="local-6989586621679332333"><span class="annot"><span class="annottext">reinstall :: m ()
</span><a href="#local-6989586621679332333"><span class="hs-identifier hs-var hs-var">reinstall</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>        </span><span id="local-6989586621679332332"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332332"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Env
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m Env
</span><a href="IC.Ref.Types.html#canisterEnv"><span class="hs-identifier hs-var">canisterEnv</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332330"><span class="annot"><span class="annottext">env1 :: Env
</span><a href="#local-6989586621679332330"><span class="hs-identifier hs-var hs-var">env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332332"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_canister_version :: Natural
</span><a href="IC.Types.html#env_canister_version"><span class="hs-identifier hs-var">env_canister_version</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; Natural
</span><a href="IC.Types.html#env_canister_version"><span class="hs-identifier hs-var hs-var">env_canister_version</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332332"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">env_global_timer :: Natural
</span><a href="IC.Types.html#env_global_timer"><span class="hs-identifier hs-var">env_global_timer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679332326"><span class="annot"><span class="annottext">WasmState
</span><a href="#local-6989586621679332326"><span class="hs-identifier hs-var">wasm_state</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679332325"><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332325"><span class="hs-identifier hs-var">ca</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TrapOr (WasmState, CanisterActions)
-&gt; m (TrapOr (WasmState, CanisterActions))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanisterModule -&gt; InitFunc
</span><a href="IC.Canister.html#init_method"><span class="hs-identifier hs-var hs-var">init_method</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterModule
</span><a href="#local-6989586621679332340"><span class="hs-identifier hs-var">new_can_mod</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332344"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332330"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
'R
  '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
     &quot;mode&quot;
     ':-&gt; Var
            ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
     &quot;wasm_module&quot; ':-&gt; ByteString]
.! &quot;arg&quot;
</span><a href="#local-6989586621679332341"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>          </span><span class="annot"><span class="annottext">m (TrapOr (WasmState, CanisterActions))
-&gt; (MethodName -&gt; m (WasmState, CanisterActions))
-&gt; m (WasmState, CanisterActions)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (TrapOr a) -&gt; (MethodName -&gt; m a) -&gt; m a
</span><a href="IC.Ref.Types.html#onTrap"><span class="hs-operator hs-var">`onTrap`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679332322"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332322"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode
-&gt; MethodName -&gt; Maybe ErrorCode -&gt; m (WasmState, CanisterActions)
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Initialization trapped: &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332322"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_TRAPPED"><span class="hs-identifier hs-var">EC_CANISTER_TRAPPED</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; CanisterContent -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; CanisterContent -&gt; m ()
</span><a href="IC.Ref.Types.html#setCanisterContent"><span class="hs-identifier hs-var">setCanisterContent</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">(CanisterContent -&gt; m ()) -&gt; CanisterContent -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterContent :: CanisterModule -&gt; WasmState -&gt; CanisterContent
</span><a href="IC.Ref.Types.html#CanisterContent"><span class="hs-identifier hs-type">CanisterContent</span></a></span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">can_mod :: CanisterModule
</span><a href="IC.Ref.Types.html#can_mod"><span class="hs-identifier hs-var">can_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanisterModule
</span><a href="#local-6989586621679332340"><span class="hs-identifier hs-var">new_can_mod</span></a></span><span>
</span><span id="line-225"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wasm_state :: WasmState
</span><a href="IC.Ref.Types.html#wasm_state"><span class="hs-identifier hs-var">wasm_state</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WasmState
</span><a href="#local-6989586621679332326"><span class="hs-identifier hs-var">wasm_state</span></a></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; CanisterActions -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; CanisterActions -&gt; m ()
</span><a href="IC.Ref.Types.html#performCanisterActions"><span class="hs-identifier hs-var">performCanisterActions</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332325"><span class="hs-identifier hs-var">ca</span></a></span><span>
</span><span id="line-228"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#bumpCanisterVersion"><span class="hs-identifier hs-var">bumpCanisterVersion</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-229"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanisterActions -&gt; Maybe ByteString
</span><a href="IC.Types.html#set_certified_data"><span class="hs-identifier hs-var hs-var">set_certified_data</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332325"><span class="hs-identifier hs-var">ca</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Maybe ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; ByteString -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; ByteString -&gt; m ()
</span><a href="IC.Ref.Types.html#setCertifiedData"><span class="hs-identifier hs-var">setCertifiedData</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-230"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanisterActions -&gt; Maybe Natural
</span><a href="IC.Types.html#set_global_timer"><span class="hs-identifier hs-var hs-var">set_global_timer</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332325"><span class="hs-identifier hs-var">ca</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Natural -&gt; Maybe Natural -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Natural
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setCanisterGlobalTimer"><span class="hs-identifier hs-var">setCanisterGlobalTimer</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span>      </span><span id="local-6989586621679332310"><span class="annot"><span class="annottext">install :: m ()
</span><a href="#local-6989586621679332310"><span class="hs-identifier hs-var hs-var">install</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679332335"><span class="hs-identifier hs-var">was_empty</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-234"></span><span>          </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;canister is not empty during installation&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_NOT_EMPTY"><span class="hs-identifier hs-var">EC_CANISTER_NOT_EMPTY</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679332333"><span class="hs-identifier hs-var">reinstall</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>      </span><span id="local-6989586621679332308"><span class="annot"><span class="annottext">upgrade :: m ()
</span><a href="#local-6989586621679332308"><span class="hs-identifier hs-var hs-var">upgrade</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679332335"><span class="hs-identifier hs-var">was_empty</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-239"></span><span>          </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;canister is empty during upgrade&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_EMPTY"><span class="hs-identifier hs-var">EC_CANISTER_EMPTY</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>        </span><span id="local-6989586621679332306"><span class="annot"><span class="annottext">WasmState
</span><a href="#local-6989586621679332306"><span class="hs-identifier hs-var">old_wasm_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m WasmState
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m WasmState
</span><a href="IC.Ref.Types.html#getCanisterState"><span class="hs-identifier hs-var">getCanisterState</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-241"></span><span>        </span><span id="local-6989586621679332304"><span class="annot"><span class="annottext">CanisterModule
</span><a href="#local-6989586621679332304"><span class="hs-identifier hs-var">old_can_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m CanisterModule
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m CanisterModule
</span><a href="IC.Ref.Types.html#getCanisterMod"><span class="hs-identifier hs-var">getCanisterMod</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-242"></span><span>        </span><span id="local-6989586621679332302"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332302"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Env
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m Env
</span><a href="IC.Ref.Types.html#canisterEnv"><span class="hs-identifier hs-var">canisterEnv</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332301"><span class="annot"><span class="annottext">env1 :: Env
</span><a href="#local-6989586621679332301"><span class="hs-identifier hs-var hs-var">env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332302"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679332300"><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332300"><span class="hs-identifier hs-var">ca1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679332299"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679332299"><span class="hs-identifier hs-var">mem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TrapOr (CanisterActions, ByteString)
-&gt; m (TrapOr (CanisterActions, ByteString))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanisterModule
-&gt; WasmState
-&gt; EntityId
-&gt; Env
-&gt; TrapOr (CanisterActions, ByteString)
</span><a href="IC.Canister.html#pre_upgrade_method"><span class="hs-identifier hs-var hs-var">pre_upgrade_method</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterModule
</span><a href="#local-6989586621679332304"><span class="hs-identifier hs-var">old_can_mod</span></a></span><span> </span><span class="annot"><span class="annottext">WasmState
</span><a href="#local-6989586621679332306"><span class="hs-identifier hs-var">old_wasm_state</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332344"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332301"><span class="hs-identifier hs-var">env1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><span class="annottext">m (TrapOr (CanisterActions, ByteString))
-&gt; (MethodName -&gt; m (CanisterActions, ByteString))
-&gt; m (CanisterActions, ByteString)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (TrapOr a) -&gt; (MethodName -&gt; m a) -&gt; m a
</span><a href="IC.Ref.Types.html#onTrap"><span class="hs-operator hs-var">`onTrap`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679332297"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332297"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode
-&gt; MethodName -&gt; Maybe ErrorCode -&gt; m (CanisterActions, ByteString)
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Pre-upgrade trapped: &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332297"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_TRAPPED"><span class="hs-identifier hs-var">EC_CANISTER_TRAPPED</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-comment">-- TODO: update balance in env based on ca1 here, once canister actions</span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-comment">-- can change balances</span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332296"><span class="annot"><span class="annottext">env2 :: Env
</span><a href="#local-6989586621679332296"><span class="hs-identifier hs-var hs-var">env2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332302"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_canister_version :: Natural
</span><a href="IC.Types.html#env_canister_version"><span class="hs-identifier hs-var">env_canister_version</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env -&gt; Natural
</span><a href="IC.Types.html#env_canister_version"><span class="hs-identifier hs-var hs-var">env_canister_version</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332302"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">env_global_timer :: Natural
</span><a href="IC.Types.html#env_global_timer"><span class="hs-identifier hs-var">env_global_timer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679332295"><span class="annot"><span class="annottext">WasmState
</span><a href="#local-6989586621679332295"><span class="hs-identifier hs-var">new_wasm_state</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679332294"><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332294"><span class="hs-identifier hs-var">ca2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TrapOr (WasmState, CanisterActions)
-&gt; m (TrapOr (WasmState, CanisterActions))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanisterModule
-&gt; EntityId
-&gt; Env
-&gt; ByteString
-&gt; ByteString
-&gt; TrapOr (WasmState, CanisterActions)
</span><a href="IC.Canister.html#post_upgrade_method"><span class="hs-identifier hs-var hs-var">post_upgrade_method</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterModule
</span><a href="#local-6989586621679332340"><span class="hs-identifier hs-var">new_can_mod</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332344"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679332296"><span class="hs-identifier hs-var">env2</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679332299"><span class="hs-identifier hs-var">mem</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
'R
  '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
     &quot;mode&quot;
     ':-&gt; Var
            ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
     &quot;wasm_module&quot; ':-&gt; ByteString]
.! &quot;arg&quot;
</span><a href="#local-6989586621679332341"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>          </span><span class="annot"><span class="annottext">m (TrapOr (WasmState, CanisterActions))
-&gt; (MethodName -&gt; m (WasmState, CanisterActions))
-&gt; m (WasmState, CanisterActions)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (TrapOr a) -&gt; (MethodName -&gt; m a) -&gt; m a
</span><a href="IC.Ref.Types.html#onTrap"><span class="hs-operator hs-var">`onTrap`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679332292"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332292"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode
-&gt; MethodName -&gt; Maybe ErrorCode -&gt; m (WasmState, CanisterActions)
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Post-upgrade trapped: &quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; MethodName -&gt; MethodName
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679332292"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_TRAPPED"><span class="hs-identifier hs-var">EC_CANISTER_TRAPPED</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; CanisterContent -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; CanisterContent -&gt; m ()
</span><a href="IC.Ref.Types.html#setCanisterContent"><span class="hs-identifier hs-var">setCanisterContent</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">(CanisterContent -&gt; m ()) -&gt; CanisterContent -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterContent :: CanisterModule -&gt; WasmState -&gt; CanisterContent
</span><a href="IC.Ref.Types.html#CanisterContent"><span class="hs-identifier hs-type">CanisterContent</span></a></span><span>
</span><span id="line-253"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">can_mod :: CanisterModule
</span><a href="IC.Ref.Types.html#can_mod"><span class="hs-identifier hs-var">can_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanisterModule
</span><a href="#local-6989586621679332340"><span class="hs-identifier hs-var">new_can_mod</span></a></span><span>
</span><span id="line-254"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">wasm_state :: WasmState
</span><a href="IC.Ref.Types.html#wasm_state"><span class="hs-identifier hs-var">wasm_state</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WasmState
</span><a href="#local-6989586621679332295"><span class="hs-identifier hs-var">new_wasm_state</span></a></span><span>
</span><span id="line-255"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; CanisterActions -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; CanisterActions -&gt; m ()
</span><a href="IC.Ref.Types.html#performCanisterActions"><span class="hs-identifier hs-var">performCanisterActions</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332300"><span class="hs-identifier hs-var">ca1</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">set_global_timer :: Maybe Natural
</span><a href="IC.Types.html#set_global_timer"><span class="hs-identifier hs-var">set_global_timer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Natural
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">CanisterActions -&gt; CanisterActions -&gt; CanisterActions
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332294"><span class="hs-identifier hs-var">ca2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">EntityId -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#bumpCanisterVersion"><span class="hs-identifier hs-var">bumpCanisterVersion</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanisterActions -&gt; Maybe Natural
</span><a href="IC.Types.html#set_global_timer"><span class="hs-identifier hs-var hs-var">set_global_timer</span></a></span><span> </span><span class="annot"><span class="annottext">CanisterActions
</span><a href="#local-6989586621679332294"><span class="hs-identifier hs-var">ca2</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Natural -&gt; Maybe Natural -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Natural
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setCanisterGlobalTimer"><span class="hs-identifier hs-var">setCanisterGlobalTimer</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332342"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">Var
  ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()])
-&gt; Rec
     ('R
        '[ &quot;install&quot; ':-&gt; (() -&gt; m ()), &quot;reinstall&quot; ':-&gt; (() -&gt; m ()),
           &quot;upgrade&quot; ':-&gt; (() -&gt; m ())])
-&gt; m ()
forall (v :: Row (*)) (r :: Row (*)) x.
BiForall r v (AppliesTo x) =&gt;
Var v -&gt; Rec r -&gt; x
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Switch.html#switch"><span class="hs-identifier hs-var">R.switch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
</span><a href="#local-6989586621679332343"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString])
-&gt; Label &quot;mode&quot;
-&gt; 'R
     '[ &quot;arg&quot; ':-&gt; ByteString, &quot;canister_id&quot; ':-&gt; Principal,
        &quot;mode&quot;
        ':-&gt; Var
               ('R '[ &quot;install&quot; ':-&gt; (), &quot;reinstall&quot; ':-&gt; (), &quot;upgrade&quot; ':-&gt; ()]),
        &quot;wasm_module&quot; ':-&gt; ByteString]
   .! &quot;mode&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;mode&quot; (Label &quot;mode&quot;)
Label &quot;mode&quot;
</span><a href="#local-6989586621679332438"><span class="hs-var">#mode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;install&quot; ':-&gt; (() -&gt; m ()), &quot;reinstall&quot; ':-&gt; (() -&gt; m ()),
         &quot;upgrade&quot; ':-&gt; (() -&gt; m ())])
 -&gt; m ())
-&gt; Rec
     ('R
        '[ &quot;install&quot; ':-&gt; (() -&gt; m ()), &quot;reinstall&quot; ':-&gt; (() -&gt; m ()),
           &quot;upgrade&quot; ':-&gt; (() -&gt; m ())])
-&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[])
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#empty"><span class="hs-identifier hs-var">R.empty</span></a></span><span>
</span><span id="line-261"></span><span>      </span><span class="annot"><span class="annottext">Rec ('R '[])
-&gt; Rec ('R '[ &quot;install&quot; ':-&gt; (() -&gt; m ())])
-&gt; Rec ('R '[] .+ 'R '[ &quot;install&quot; ':-&gt; (() -&gt; m ())])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;install&quot; (Label &quot;install&quot;)
Label &quot;install&quot;
</span><a href="#local-6989586621679332425"><span class="hs-var">#install</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;install&quot;
-&gt; (() -&gt; m ()) -&gt; Rec (Extend &quot;install&quot; (() -&gt; m ()) ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679332310"><span class="hs-identifier hs-var">install</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>      </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;install&quot; ':-&gt; (() -&gt; m ())])
-&gt; Rec ('R '[ &quot;reinstall&quot; ':-&gt; (() -&gt; m ())])
-&gt; Rec
     ('R '[ &quot;install&quot; ':-&gt; (() -&gt; m ())]
      .+ 'R '[ &quot;reinstall&quot; ':-&gt; (() -&gt; m ())])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;reinstall&quot; (Label &quot;reinstall&quot;)
Label &quot;reinstall&quot;
</span><a href="#local-6989586621679332421"><span class="hs-var">#reinstall</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;reinstall&quot;
-&gt; (() -&gt; m ()) -&gt; Rec (Extend &quot;reinstall&quot; (() -&gt; m ()) ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679332333"><span class="hs-identifier hs-var">reinstall</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">Rec
  ('R '[ &quot;install&quot; ':-&gt; (() -&gt; m ()), &quot;reinstall&quot; ':-&gt; (() -&gt; m ())])
-&gt; Rec ('R '[ &quot;upgrade&quot; ':-&gt; (() -&gt; m ())])
-&gt; Rec
     ('R '[ &quot;install&quot; ':-&gt; (() -&gt; m ()), &quot;reinstall&quot; ':-&gt; (() -&gt; m ())]
      .+ 'R '[ &quot;upgrade&quot; ':-&gt; (() -&gt; m ())])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;upgrade&quot; (Label &quot;upgrade&quot;)
Label &quot;upgrade&quot;
</span><a href="#local-6989586621679332417"><span class="hs-var">#upgrade</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;upgrade&quot;
-&gt; (() -&gt; m ()) -&gt; Rec (Extend &quot;upgrade&quot; (() -&gt; m ()) ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621679332308"><span class="hs-identifier hs-var">upgrade</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span id="local-6989586621679334729"><span class="annot"><a href="IC.Ref.Management.html#icUninstallCode"><span class="hs-identifier hs-type">icUninstallCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334729"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334729"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334729"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;uninstall_code&quot;</span></span></span><span>
</span><span id="line-266"></span><span id="icUninstallCode"><span class="annot"><span class="annottext">icUninstallCode :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;uninstall_code&quot;
</span><a href="IC.Ref.Management.html#icUninstallCode"><span class="hs-identifier hs-var hs-var">icUninstallCode</span></a></span></span><span> </span><span id="local-6989586621679332255"><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679332255"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332254"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679332254"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679332255"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R '[ &quot;canister_id&quot; ':-&gt; Principal] .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332286"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-comment">-- empty canister, resetting selected state</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; (CanState -&gt; CanState) -&gt; m ()
forall (m :: * -&gt; *).
ICM m =&gt;
EntityId -&gt; (CanState -&gt; CanState) -&gt; m ()
</span><a href="IC.Ref.Types.html#modCanister"><span class="hs-identifier hs-var">modCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332254"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">((CanState -&gt; CanState) -&gt; m ()) -&gt; (CanState -&gt; CanState) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679332252"><span class="annot"><span class="annottext">CanState
</span><a href="#local-6989586621679332252"><span class="hs-identifier hs-var">can_state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CanState
</span><a href="#local-6989586621679332252"><span class="hs-identifier hs-var">can_state</span></a></span><span>
</span><span id="line-270"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">content :: Maybe CanisterContent
</span><a href="IC.Ref.Types.html#content"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CanisterContent
forall a. Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-271"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certified_data :: ByteString
</span><a href="IC.Ref.Types.html#certified_data"><span class="hs-identifier hs-var">certified_data</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-272"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">canister_version :: Natural
</span><a href="IC.Ref.Types.html#canister_version"><span class="hs-identifier hs-var">canister_version</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CanState -&gt; Natural
</span><a href="IC.Ref.Types.html#canister_version"><span class="hs-identifier hs-var hs-var">canister_version</span></a></span><span> </span><span class="annot"><span class="annottext">CanState
</span><a href="#local-6989586621679332252"><span class="hs-identifier hs-var">can_state</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span>
</span><span id="line-273"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">global_timer :: Natural
</span><a href="IC.Ref.Types.html#global_timer"><span class="hs-identifier hs-var">global_timer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-274"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-comment">-- reject all call open contexts of this canister</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="annottext">(IC -&gt; [(CallId, CallContext)]) -&gt; m [(CallId, CallContext)]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CallId CallContext -&gt; [(CallId, CallContext)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">M.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CallId CallContext -&gt; [(CallId, CallContext)])
-&gt; (IC -&gt; Map CallId CallContext) -&gt; IC -&gt; [(CallId, CallContext)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IC -&gt; Map CallId CallContext
</span><a href="IC.Ref.Types.html#call_contexts"><span class="hs-identifier hs-var hs-var">call_contexts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m [(CallId, CallContext)]
-&gt; ([(CallId, CallContext)] -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">((CallId, CallContext) -&gt; m ()) -&gt; [(CallId, CallContext)] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679332244"><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332244"><span class="hs-identifier hs-var">ctxt_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679332243"><span class="annot"><span class="annottext">CallContext
</span><a href="#local-6989586621679332243"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CallContext -&gt; EntityId
</span><a href="IC.Ref.Types.html#canister"><span class="hs-identifier hs-var hs-var">canister</span></a></span><span> </span><span class="annot"><span class="annottext">CallContext
</span><a href="#local-6989586621679332243"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; EntityId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332254"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">CallContext -&gt; NeedsToRespond
</span><a href="IC.Ref.Types.html#needs_to_respond"><span class="hs-identifier hs-var hs-var">needs_to_respond</span></a></span><span> </span><span class="annot"><span class="annottext">CallContext
</span><a href="#local-6989586621679332243"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">NeedsToRespond -&gt; NeedsToRespond -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; NeedsToRespond
</span><a href="IC.Types.html#NeedsToRespond"><span class="hs-identifier hs-var">NeedsToRespond</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>            </span><span class="annot"><span class="annottext">CallId -&gt; (RejectCode, MethodName, Maybe ErrorCode) -&gt; m ()
forall (m :: * -&gt; *).
ICM m =&gt;
CallId -&gt; (RejectCode, MethodName, Maybe ErrorCode) -&gt; m ()
</span><a href="IC.Ref.Types.html#rejectCallContext"><span class="hs-identifier hs-var">rejectCallContext</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332244"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_REJECT"><span class="hs-identifier hs-var">RC_CANISTER_REJECT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Canister has been uninstalled&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_EMPTY"><span class="hs-identifier hs-var">EC_CANISTER_EMPTY</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>            </span><span class="annot"><span class="annottext">CallId -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; m ()
</span><a href="IC.Ref.Types.html#deleteCallContext"><span class="hs-identifier hs-var">deleteCallContext</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332244"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span id="local-6989586621679334728"><span class="annot"><a href="IC.Ref.Management.html#icUpdateCanisterSettings"><span class="hs-identifier hs-type">icUpdateCanisterSettings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334728"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334728"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334728"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;update_settings&quot;</span></span></span><span>
</span><span id="line-283"></span><span id="icUpdateCanisterSettings"><span class="annot"><span class="annottext">icUpdateCanisterSettings :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;update_settings&quot;
</span><a href="IC.Ref.Management.html#icUpdateCanisterSettings"><span class="hs-identifier hs-var hs-var">icUpdateCanisterSettings</span></a></span></span><span> </span><span id="local-6989586621679332211"><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
</span><a href="#local-6989586621679332211"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332210"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679332210"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
</span><a href="#local-6989586621679332211"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])]
   .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332233"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><span class="annottext">Settings -&gt; m ()
forall (m :: * -&gt; *). CanReject m =&gt; Settings -&gt; m ()
</span><a href="IC.Ref.Management.html#validateSettings"><span class="hs-identifier hs-var">validateSettings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
</span><a href="#local-6989586621679332211"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
-&gt; Label &quot;settings&quot;
-&gt; 'R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])]
   .! &quot;settings&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;settings&quot; (Label &quot;settings&quot;)
Label &quot;settings&quot;
</span><a href="#local-6989586621679332227"><span class="hs-var">#settings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; Settings -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Settings -&gt; m ()
</span><a href="IC.Ref.Management.html#applySettings"><span class="hs-identifier hs-var">applySettings</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332210"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
</span><a href="#local-6989586621679332211"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])])
-&gt; Label &quot;settings&quot;
-&gt; 'R
     '[ &quot;canister_id&quot; ':-&gt; Principal,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Maybe Natural,
                     &quot;controllers&quot; ':-&gt; Maybe (Vector Principal),
                     &quot;freezing_threshold&quot; ':-&gt; Maybe Natural,
                     &quot;memory_allocation&quot; ':-&gt; Maybe Natural])]
   .! &quot;settings&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;settings&quot; (Label &quot;settings&quot;)
Label &quot;settings&quot;
</span><a href="#local-6989586621679332218"><span class="hs-var">#settings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#bumpCanisterVersion"><span class="hs-identifier hs-var">bumpCanisterVersion</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332210"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span id="local-6989586621679334727"><span class="annot"><a href="IC.Ref.Management.html#icStartCanister"><span class="hs-identifier hs-type">icStartCanister</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334727"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334727"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334727"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;start_canister&quot;</span></span></span><span>
</span><span id="line-290"></span><span id="icStartCanister"><span class="annot"><span class="annottext">icStartCanister :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;start_canister&quot;
</span><a href="IC.Ref.Management.html#icStartCanister"><span class="hs-identifier hs-var hs-var">icStartCanister</span></a></span></span><span> </span><span id="local-6989586621679332180"><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679332180"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332179"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679332179"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679332180"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R '[ &quot;canister_id&quot; ':-&gt; Principal] .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332206"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m RunStatus
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m RunStatus
</span><a href="IC.Ref.Types.html#getRunStatus"><span class="hs-identifier hs-var">getRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332179"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">m RunStatus -&gt; (RunStatus -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsRunning"><span class="hs-identifier hs-var">IsRunning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><a href="IC.Ref.Types.html#IsStopping"><span class="hs-identifier hs-type">IsStopping</span></a></span><span> </span><span id="local-6989586621679332175"><span class="annot"><span class="annottext">[CallId]
</span><a href="#local-6989586621679332175"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-295"></span><span>            </span><span class="annot"><span class="annottext">[CallId] -&gt; (CallId -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[CallId]
</span><a href="#local-6989586621679332175"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">((CallId -&gt; m ()) -&gt; m ()) -&gt; (CallId -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679332174"><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332174"><span class="hs-identifier hs-var">ctxt_id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-296"></span><span>                </span><span class="annot"><span class="annottext">CallId -&gt; (RejectCode, MethodName, Maybe ErrorCode) -&gt; m ()
forall (m :: * -&gt; *).
ICM m =&gt;
CallId -&gt; (RejectCode, MethodName, Maybe ErrorCode) -&gt; m ()
</span><a href="IC.Ref.Types.html#rejectCallContext"><span class="hs-identifier hs-var">rejectCallContext</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332174"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Canister has been restarted&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_RESTARTED"><span class="hs-identifier hs-var">EC_CANISTER_RESTARTED</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>            </span><span class="annot"><span class="annottext">EntityId -&gt; RunStatus -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; RunStatus -&gt; m ()
</span><a href="IC.Ref.Types.html#setRunStatus"><span class="hs-identifier hs-var">setRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332179"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsRunning"><span class="hs-identifier hs-var">IsRunning</span></a></span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsStopped"><span class="hs-identifier hs-var">IsStopped</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; RunStatus -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; RunStatus -&gt; m ()
</span><a href="IC.Ref.Types.html#setRunStatus"><span class="hs-identifier hs-var">setRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332179"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsRunning"><span class="hs-identifier hs-var">IsRunning</span></a></span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsDeleted"><span class="hs-identifier hs-var">IsDeleted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; m ()
forall a. HasCallStack =&gt; MethodName -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;deleted canister encountered&quot;</span></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="local-6989586621679334723"><span id="local-6989586621679334724"><span id="local-6989586621679334725"><span class="annot"><a href="IC.Ref.Management.html#icStopCanister"><span class="hs-identifier hs-type">icStopCanister</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679334724"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334723"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/ghc-prim-0.7.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;stop_canister&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><a href="IC.Ref.Types.html#CallId"><span class="hs-identifier hs-type">CallId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334724"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-305"></span><span id="icStopCanister"><span class="annot"><span class="annottext">icStopCanister :: forall (m :: * -&gt; *) a b.
(ICM m, CanReject m,
 (a -&gt; m b) ~ (ICManagement m .! &quot;stop_canister&quot;)) =&gt;
CallId -&gt; a -&gt; m ()
</span><a href="IC.Ref.Management.html#icStopCanister"><span class="hs-identifier hs-var hs-var">icStopCanister</span></a></span></span><span> </span><span id="local-6989586621679332133"><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332133"><span class="hs-identifier hs-var">ctxt_id</span></a></span></span><span> </span><span id="local-6989586621679332132"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679332132"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679332131"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679332131"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679332132"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R '[ &quot;canister_id&quot; ':-&gt; Principal] .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332165"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m RunStatus
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m RunStatus
</span><a href="IC.Ref.Types.html#getRunStatus"><span class="hs-identifier hs-var">getRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332131"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">m RunStatus -&gt; (RunStatus -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsRunning"><span class="hs-identifier hs-var">IsRunning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; RunStatus -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; RunStatus -&gt; m ()
</span><a href="IC.Ref.Types.html#setRunStatus"><span class="hs-identifier hs-var">setRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332131"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CallId] -&gt; RunStatus
</span><a href="IC.Ref.Types.html#IsStopping"><span class="hs-identifier hs-var">IsStopping</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332133"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><a href="IC.Ref.Types.html#IsStopping"><span class="hs-identifier hs-type">IsStopping</span></a></span><span> </span><span id="local-6989586621679332130"><span class="annot"><span class="annottext">[CallId]
</span><a href="#local-6989586621679332130"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; RunStatus -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; RunStatus -&gt; m ()
</span><a href="IC.Ref.Types.html#setRunStatus"><span class="hs-identifier hs-var">setRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679332131"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CallId] -&gt; RunStatus
</span><a href="IC.Ref.Types.html#IsStopping"><span class="hs-identifier hs-var">IsStopping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CallId]
</span><a href="#local-6989586621679332130"><span class="hs-identifier hs-var">pending</span></a></span><span> </span><span class="annot"><span class="annottext">[CallId] -&gt; [CallId] -&gt; [CallId]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332133"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsStopped"><span class="hs-identifier hs-var">IsStopped</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CallId -&gt; ByteString -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; ByteString -&gt; m ()
</span><a href="IC.Ref.Types.html#replyCallContext"><span class="hs-identifier hs-var">replyCallContext</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679332133"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; ByteString
forall a. CandidArg a =&gt; a -&gt; ByteString
</span><a href="file:///nix/store/5q8knwbpcq1xjhfifih1jfwmvd2jr0sg-candid-0.4-doc/share/doc/candid-0.4/html/src/Codec.Candid.Class.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsDeleted"><span class="hs-identifier hs-var">IsDeleted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; m ()
forall a. HasCallStack =&gt; MethodName -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;deleted canister encountered&quot;</span></span><span>
</span><span id="line-312"></span><span>
</span><span id="line-313"></span><span id="local-6989586621679334722"><span class="annot"><a href="IC.Ref.Management.html#icCanisterStatus"><span class="hs-identifier hs-type">icCanisterStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334722"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334722"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334722"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;canister_status&quot;</span></span></span><span>
</span><span id="line-314"></span><span id="icCanisterStatus"><span class="annot"><span class="annottext">icCanisterStatus :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;canister_status&quot;
</span><a href="IC.Ref.Management.html#icCanisterStatus"><span class="hs-identifier hs-var hs-var">icCanisterStatus</span></a></span></span><span> </span><span id="local-6989586621679331938"><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331938"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679331937"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679331937"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331938"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R '[ &quot;canister_id&quot; ':-&gt; Principal] .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679332126"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>    </span><span id="local-6989586621679331936"><span class="annot"><span class="annottext">Var
  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
</span><a href="#local-6989586621679331936"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m RunStatus
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m RunStatus
</span><a href="IC.Ref.Types.html#getRunStatus"><span class="hs-identifier hs-var">getRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331937"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">m RunStatus
-&gt; (RunStatus
    -&gt; m (Var
            ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])))
-&gt; m (Var
        ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-317"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsRunning"><span class="hs-identifier hs-var">IsRunning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
-&gt; m (Var
        ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label &quot;running&quot;
-&gt; ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]
    .! &quot;running&quot;)
-&gt; Var
     ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
forall (l :: Symbol) (r :: Row (*)).
(AllUniqueLabels r, KnownSymbol l) =&gt;
Label l -&gt; (r .! l) -&gt; Var r
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Variants.html#IsJust"><span class="hs-identifier hs-var">V.IsJust</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;running&quot; (Label &quot;running&quot;)
Label &quot;running&quot;
</span><a href="#local-6989586621679332112"><span class="hs-var">#running</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><a href="IC.Ref.Types.html#IsStopping"><span class="hs-identifier hs-type">IsStopping</span></a></span><span> </span><span id="local-6989586621679331934"><span class="annot"><span class="annottext">[CallId]
</span><a href="#local-6989586621679331934"><span class="hs-identifier hs-var">_pending</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
-&gt; m (Var
        ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label &quot;stopping&quot;
-&gt; ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]
    .! &quot;stopping&quot;)
-&gt; Var
     ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
forall (l :: Symbol) (r :: Row (*)).
(AllUniqueLabels r, KnownSymbol l) =&gt;
Label l -&gt; (r .! l) -&gt; Var r
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Variants.html#IsJust"><span class="hs-identifier hs-var">V.IsJust</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;stopping&quot; (Label &quot;stopping&quot;)
Label &quot;stopping&quot;
</span><a href="#local-6989586621679332106"><span class="hs-var">#stopping</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsStopped"><span class="hs-identifier hs-var">IsStopped</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Var
  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
-&gt; m (Var
        ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Label &quot;stopped&quot;
-&gt; ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]
    .! &quot;stopped&quot;)
-&gt; Var
     ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
forall (l :: Symbol) (r :: Row (*)).
(AllUniqueLabels r, KnownSymbol l) =&gt;
Label l -&gt; (r .! l) -&gt; Var r
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Variants.html#IsJust"><span class="hs-identifier hs-var">V.IsJust</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;stopped&quot; (Label &quot;stopped&quot;)
Label &quot;stopped&quot;
</span><a href="#local-6989586621679332100"><span class="hs-var">#stopped</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsDeleted"><span class="hs-identifier hs-var">IsDeleted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MethodName
-&gt; m (Var
        ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]))
forall a. HasCallStack =&gt; MethodName -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;deleted canister encountered&quot;</span></span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621679331933"><span class="annot"><span class="annottext">CanState
</span><a href="#local-6989586621679331933"><span class="hs-identifier hs-var">can_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m CanState
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m CanState
</span><a href="IC.Ref.Types.html#getCanister"><span class="hs-identifier hs-var">getCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331937"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span id="local-6989586621679331931"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679331931"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanState -&gt; Maybe ByteString
</span><a href="IC.Ref.Types.html#module_hash"><span class="hs-identifier hs-var">module_hash</span></a></span><span> </span><span class="annot"><span class="annottext">(CanState -&gt; Maybe ByteString)
-&gt; m CanState -&gt; m (Maybe ByteString)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m CanState
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m CanState
</span><a href="IC.Ref.Types.html#getCanister"><span class="hs-identifier hs-var">getCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331937"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621679331929"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331929"><span class="hs-identifier hs-var">cycles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Natural
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m Natural
</span><a href="IC.Ref.Types.html#getBalance"><span class="hs-identifier hs-var">getBalance</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331937"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679331927"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331927"><span class="hs-identifier hs-var">idle_cycles_burned_per_day</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CanState -&gt; Natural
</span><a href="IC.Ref.Types.html#idle_cycles_burned_per_day"><span class="hs-identifier hs-var">idle_cycles_burned_per_day</span></a></span><span> </span><span class="annot"><span class="annottext">(CanState -&gt; Natural) -&gt; m CanState -&gt; m Natural
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m CanState
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m CanState
</span><a href="IC.Ref.Types.html#getCanister"><span class="hs-identifier hs-var">getCanister</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331937"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;cycles&quot; ':-&gt; Natural,
        &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
        &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                     &quot;controllers&quot; ':-&gt; Vector Principal,
                     &quot;freezing_threshold&quot; ':-&gt; Natural,
                     &quot;memory_allocation&quot; ':-&gt; Natural]),
        &quot;status&quot;
        ':-&gt; Var
               ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
-&gt; m (Rec
        ('R
           '[ &quot;cycles&quot; ':-&gt; Natural,
              &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
              &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
              &quot;settings&quot;
              ':-&gt; Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                           &quot;controllers&quot; ':-&gt; Vector Principal,
                           &quot;freezing_threshold&quot; ':-&gt; Natural,
                           &quot;memory_allocation&quot; ':-&gt; Natural]),
              &quot;status&quot;
              ':-&gt; Var
                     ('R
                        '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R
      '[ &quot;cycles&quot; ':-&gt; Natural,
         &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
         &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
         &quot;settings&quot;
         ':-&gt; Rec
                ('R
                   '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                      &quot;controllers&quot; ':-&gt; Vector Principal,
                      &quot;freezing_threshold&quot; ':-&gt; Natural,
                      &quot;memory_allocation&quot; ':-&gt; Natural]),
         &quot;status&quot;
         ':-&gt; Var
                ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
 -&gt; m (Rec
         ('R
            '[ &quot;cycles&quot; ':-&gt; Natural,
               &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
               &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
               &quot;settings&quot;
               ':-&gt; Rec
                      ('R
                         '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                            &quot;controllers&quot; ':-&gt; Vector Principal,
                            &quot;freezing_threshold&quot; ':-&gt; Natural,
                            &quot;memory_allocation&quot; ':-&gt; Natural]),
               &quot;status&quot;
               ':-&gt; Var
                      ('R
                         '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])))
-&gt; Rec
     ('R
        '[ &quot;cycles&quot; ':-&gt; Natural,
           &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
           &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
           &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                        &quot;controllers&quot; ':-&gt; Vector Principal,
                        &quot;freezing_threshold&quot; ':-&gt; Natural,
                        &quot;memory_allocation&quot; ':-&gt; Natural]),
           &quot;status&quot;
           ':-&gt; Var
                  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
-&gt; m (Rec
        ('R
           '[ &quot;cycles&quot; ':-&gt; Natural,
              &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural,
              &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
              &quot;settings&quot;
              ':-&gt; Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                           &quot;controllers&quot; ':-&gt; Vector Principal,
                           &quot;freezing_threshold&quot; ':-&gt; Natural,
                           &quot;memory_allocation&quot; ':-&gt; Natural]),
              &quot;status&quot;
              ':-&gt; Var
                     ('R
                        '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[])
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#empty"><span class="hs-identifier hs-var">R.empty</span></a></span><span>
</span><span id="line-326"></span><span>      </span><span class="annot"><span class="annottext">Rec ('R '[])
-&gt; Rec
     ('R
        '[ &quot;status&quot;
           ':-&gt; Var
                  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
-&gt; Rec
     ('R '[]
      .+ 'R
           '[ &quot;status&quot;
              ':-&gt; Var
                     ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;status&quot; (Label &quot;status&quot;)
Label &quot;status&quot;
</span><a href="#local-6989586621679332051"><span class="hs-var">#status</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;status&quot;
-&gt; Var
     ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
-&gt; Rec
     (Extend
        &quot;status&quot;
        (Var
           ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()]))
        ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">Var
  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])
</span><a href="#local-6989586621679331936"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-327"></span><span>      </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;status&quot;
        ':-&gt; Var
               ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
-&gt; Rec
     ('R
        '[ &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                        &quot;controllers&quot; ':-&gt; Vector Principal,
                        &quot;freezing_threshold&quot; ':-&gt; Natural,
                        &quot;memory_allocation&quot; ':-&gt; Natural])])
-&gt; Rec
     ('R
        '[ &quot;status&quot;
           ':-&gt; Var
                  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]
      .+ 'R
           '[ &quot;settings&quot;
              ':-&gt; Rec
                     ('R
                        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                           &quot;controllers&quot; ':-&gt; Vector Principal,
                           &quot;freezing_threshold&quot; ':-&gt; Natural,
                           &quot;memory_allocation&quot; ':-&gt; Natural])])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;settings&quot; (Label &quot;settings&quot;)
Label &quot;settings&quot;
</span><a href="#local-6989586621679332048"><span class="hs-var">#settings</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;settings&quot;
-&gt; Rec
     ('R
        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
           &quot;controllers&quot; ':-&gt; Vector Principal,
           &quot;freezing_threshold&quot; ':-&gt; Natural,
           &quot;memory_allocation&quot; ':-&gt; Natural])
-&gt; Rec
     (&quot;settings&quot;
      .== Rec
            ('R
               '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                  &quot;controllers&quot; ':-&gt; Vector Principal,
                  &quot;freezing_threshold&quot; ':-&gt; Natural,
                  &quot;memory_allocation&quot; ':-&gt; Natural]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec ('R '[])
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#empty"><span class="hs-identifier hs-var">R.empty</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><span class="annottext">Rec ('R '[])
-&gt; Rec ('R '[ &quot;controllers&quot; ':-&gt; Vector Principal])
-&gt; Rec ('R '[] .+ 'R '[ &quot;controllers&quot; ':-&gt; Vector Principal])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;controllers&quot; (Label &quot;controllers&quot;)
Label &quot;controllers&quot;
</span><a href="#local-6989586621679332031"><span class="hs-var">#controllers</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;controllers&quot;
-&gt; Vector Principal
-&gt; Rec (Extend &quot;controllers&quot; (Vector Principal) ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">[Principal] -&gt; Vector Principal
forall a. [a] -&gt; Vector a
</span><a href="file:///nix/store/5xj65cipwzdnpp6y5z9vwld366h065w2-vector-0.12.3.1-doc/share/doc/vector-0.12.3.1/html/src/Data.Vector.html#fromList"><span class="hs-identifier hs-var">Vec.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EntityId -&gt; Principal) -&gt; [EntityId] -&gt; [Principal]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; Principal
</span><a href="IC.Management.html#entityIdToPrincipal"><span class="hs-identifier hs-var">entityIdToPrincipal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set EntityId -&gt; [EntityId]
forall a. Set a -&gt; [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/containers-0.6.4.1/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CanState -&gt; Set EntityId
</span><a href="IC.Ref.Types.html#controllers"><span class="hs-identifier hs-var hs-var">controllers</span></a></span><span> </span><span class="annot"><span class="annottext">CanState
</span><a href="#local-6989586621679331933"><span class="hs-identifier hs-var">can_state</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;controllers&quot; ':-&gt; Vector Principal])
-&gt; Rec ('R '[ &quot;memory_allocation&quot; ':-&gt; Natural])
-&gt; Rec
     ('R '[ &quot;controllers&quot; ':-&gt; Vector Principal]
      .+ 'R '[ &quot;memory_allocation&quot; ':-&gt; Natural])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;memory_allocation&quot; (Label &quot;memory_allocation&quot;)
Label &quot;memory_allocation&quot;
</span><a href="#local-6989586621679332027"><span class="hs-var">#memory_allocation</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;memory_allocation&quot;
-&gt; Natural -&gt; Rec (Extend &quot;memory_allocation&quot; Natural ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">CanState -&gt; Natural
</span><a href="IC.Ref.Types.html#memory_allocation"><span class="hs-identifier hs-var hs-var">memory_allocation</span></a></span><span> </span><span class="annot"><span class="annottext">CanState
</span><a href="#local-6989586621679331933"><span class="hs-identifier hs-var">can_state</span></a></span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;controllers&quot; ':-&gt; Vector Principal,
        &quot;memory_allocation&quot; ':-&gt; Natural])
-&gt; Rec ('R '[ &quot;compute_allocation&quot; ':-&gt; Natural])
-&gt; Rec
     ('R
        '[ &quot;controllers&quot; ':-&gt; Vector Principal,
           &quot;memory_allocation&quot; ':-&gt; Natural]
      .+ 'R '[ &quot;compute_allocation&quot; ':-&gt; Natural])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;compute_allocation&quot; (Label &quot;compute_allocation&quot;)
Label &quot;compute_allocation&quot;
</span><a href="#local-6989586621679332024"><span class="hs-var">#compute_allocation</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;compute_allocation&quot;
-&gt; Natural -&gt; Rec (&quot;compute_allocation&quot; .== Natural)
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">CanState -&gt; Natural
</span><a href="IC.Ref.Types.html#compute_allocation"><span class="hs-identifier hs-var hs-var">compute_allocation</span></a></span><span> </span><span class="annot"><span class="annottext">CanState
</span><a href="#local-6989586621679331933"><span class="hs-identifier hs-var">can_state</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;compute_allocation&quot; ':-&gt; Natural,
        &quot;controllers&quot; ':-&gt; Vector Principal,
        &quot;memory_allocation&quot; ':-&gt; Natural])
-&gt; Rec ('R '[ &quot;freezing_threshold&quot; ':-&gt; Natural])
-&gt; Rec
     ('R
        '[ &quot;compute_allocation&quot; ':-&gt; Natural,
           &quot;controllers&quot; ':-&gt; Vector Principal,
           &quot;memory_allocation&quot; ':-&gt; Natural]
      .+ 'R '[ &quot;freezing_threshold&quot; ':-&gt; Natural])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;freezing_threshold&quot; (Label &quot;freezing_threshold&quot;)
Label &quot;freezing_threshold&quot;
</span><a href="#local-6989586621679332021"><span class="hs-var">#freezing_threshold</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;freezing_threshold&quot;
-&gt; Natural -&gt; Rec (&quot;freezing_threshold&quot; .== Natural)
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">CanState -&gt; Natural
</span><a href="IC.Ref.Types.html#freezing_threshold"><span class="hs-identifier hs-var hs-var">freezing_threshold</span></a></span><span> </span><span class="annot"><span class="annottext">CanState
</span><a href="#local-6989586621679331933"><span class="hs-identifier hs-var">can_state</span></a></span><span>
</span><span id="line-332"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                     &quot;controllers&quot; ':-&gt; Vector Principal,
                     &quot;freezing_threshold&quot; ':-&gt; Natural,
                     &quot;memory_allocation&quot; ':-&gt; Natural]),
        &quot;status&quot;
        ':-&gt; Var
               ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
-&gt; Rec ('R '[ &quot;memory_size&quot; ':-&gt; Natural])
-&gt; Rec
     ('R
        '[ &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                        &quot;controllers&quot; ':-&gt; Vector Principal,
                        &quot;freezing_threshold&quot; ':-&gt; Natural,
                        &quot;memory_allocation&quot; ':-&gt; Natural]),
           &quot;status&quot;
           ':-&gt; Var
                  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]
      .+ 'R '[ &quot;memory_size&quot; ':-&gt; Natural])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;memory_size&quot; (Label &quot;memory_size&quot;)
Label &quot;memory_size&quot;
</span><a href="#local-6989586621679332018"><span class="hs-var">#memory_size</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;memory_size&quot; -&gt; Natural -&gt; Rec (&quot;memory_size&quot; .== Natural)
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- not implemented here</span><span>
</span><span id="line-334"></span><span>      </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;memory_size&quot; ':-&gt; Natural,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                     &quot;controllers&quot; ':-&gt; Vector Principal,
                     &quot;freezing_threshold&quot; ':-&gt; Natural,
                     &quot;memory_allocation&quot; ':-&gt; Natural]),
        &quot;status&quot;
        ':-&gt; Var
               ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
-&gt; Rec ('R '[ &quot;module_hash&quot; ':-&gt; Maybe ByteString])
-&gt; Rec
     ('R
        '[ &quot;memory_size&quot; ':-&gt; Natural,
           &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                        &quot;controllers&quot; ':-&gt; Vector Principal,
                        &quot;freezing_threshold&quot; ':-&gt; Natural,
                        &quot;memory_allocation&quot; ':-&gt; Natural]),
           &quot;status&quot;
           ':-&gt; Var
                  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]
      .+ 'R '[ &quot;module_hash&quot; ':-&gt; Maybe ByteString])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;module_hash&quot; (Label &quot;module_hash&quot;)
Label &quot;module_hash&quot;
</span><a href="#local-6989586621679332013"><span class="hs-var">#module_hash</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;module_hash&quot;
-&gt; Maybe ByteString -&gt; Rec (&quot;module_hash&quot; .== Maybe ByteString)
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679331931"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-335"></span><span>      </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                     &quot;controllers&quot; ':-&gt; Vector Principal,
                     &quot;freezing_threshold&quot; ':-&gt; Natural,
                     &quot;memory_allocation&quot; ':-&gt; Natural]),
        &quot;status&quot;
        ':-&gt; Var
               ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
-&gt; Rec ('R '[ &quot;cycles&quot; ':-&gt; Natural])
-&gt; Rec
     ('R
        '[ &quot;memory_size&quot; ':-&gt; Natural, &quot;module_hash&quot; ':-&gt; Maybe ByteString,
           &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                        &quot;controllers&quot; ':-&gt; Vector Principal,
                        &quot;freezing_threshold&quot; ':-&gt; Natural,
                        &quot;memory_allocation&quot; ':-&gt; Natural]),
           &quot;status&quot;
           ':-&gt; Var
                  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]
      .+ 'R '[ &quot;cycles&quot; ':-&gt; Natural])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;cycles&quot; (Label &quot;cycles&quot;)
Label &quot;cycles&quot;
</span><a href="#local-6989586621679332010"><span class="hs-var">#cycles</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;cycles&quot; -&gt; Natural -&gt; Rec (&quot;cycles&quot; .== Natural)
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331929"><span class="hs-identifier hs-var">cycles</span></a></span><span>
</span><span id="line-336"></span><span>      </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;cycles&quot; ':-&gt; Natural, &quot;memory_size&quot; ':-&gt; Natural,
        &quot;module_hash&quot; ':-&gt; Maybe ByteString,
        &quot;settings&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                     &quot;controllers&quot; ':-&gt; Vector Principal,
                     &quot;freezing_threshold&quot; ':-&gt; Natural,
                     &quot;memory_allocation&quot; ':-&gt; Natural]),
        &quot;status&quot;
        ':-&gt; Var
               ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])])
-&gt; Rec ('R '[ &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural])
-&gt; Rec
     ('R
        '[ &quot;cycles&quot; ':-&gt; Natural, &quot;memory_size&quot; ':-&gt; Natural,
           &quot;module_hash&quot; ':-&gt; Maybe ByteString,
           &quot;settings&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;compute_allocation&quot; ':-&gt; Natural,
                        &quot;controllers&quot; ':-&gt; Vector Principal,
                        &quot;freezing_threshold&quot; ':-&gt; Natural,
                        &quot;memory_allocation&quot; ':-&gt; Natural]),
           &quot;status&quot;
           ':-&gt; Var
                  ('R '[ &quot;running&quot; ':-&gt; (), &quot;stopped&quot; ':-&gt; (), &quot;stopping&quot; ':-&gt; ()])]
      .+ 'R '[ &quot;idle_cycles_burned_per_day&quot; ':-&gt; Natural])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;idle_cycles_burned_per_day&quot; (Label &quot;idle_cycles_burned_per_day&quot;)
Label &quot;idle_cycles_burned_per_day&quot;
</span><a href="#local-6989586621679332007"><span class="hs-var">#idle_cycles_burned_per_day</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;idle_cycles_burned_per_day&quot;
-&gt; Natural -&gt; Rec (&quot;idle_cycles_burned_per_day&quot; .== Natural)
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331927"><span class="hs-identifier hs-var">idle_cycles_burned_per_day</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span id="local-6989586621679334721"><span class="annot"><a href="IC.Ref.Management.html#icDeleteCanister"><span class="hs-identifier hs-type">icDeleteCanister</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334721"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334721"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;delete_canister&quot;</span></span></span><span>
</span><span id="line-340"></span><span id="icDeleteCanister"><span class="annot"><span class="annottext">icDeleteCanister :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;delete_canister&quot;
</span><a href="IC.Ref.Management.html#icDeleteCanister"><span class="hs-identifier hs-var hs-var">icDeleteCanister</span></a></span></span><span> </span><span id="local-6989586621679331897"><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331897"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679331896"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679331896"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331897"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R '[ &quot;canister_id&quot; ':-&gt; Principal] .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679331917"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m RunStatus
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m RunStatus
</span><a href="IC.Ref.Types.html#getRunStatus"><span class="hs-identifier hs-var">getRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331896"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">m RunStatus -&gt; (RunStatus -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsRunning"><span class="hs-identifier hs-var">IsRunning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Cannot delete running canister&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_NOT_STOPPED"><span class="hs-identifier hs-var">EC_CANISTER_NOT_STOPPED</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>        </span><span class="annot"><a href="IC.Ref.Types.html#IsStopping"><span class="hs-identifier hs-type">IsStopping</span></a></span><span> </span><span id="local-6989586621679331894"><span class="annot"><span class="annottext">[CallId]
</span><a href="#local-6989586621679331894"><span class="hs-identifier hs-var">_pending</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m ()
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;Cannot delete stopping canister&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_CANISTER_NOT_STOPPED"><span class="hs-identifier hs-var">EC_CANISTER_NOT_STOPPED</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsStopped"><span class="hs-identifier hs-var">IsStopped</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsDeleted"><span class="hs-identifier hs-var">IsDeleted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MethodName -&gt; m ()
forall a. HasCallStack =&gt; MethodName -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><span class="hs-string">&quot;deleted canister encountered&quot;</span></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; RunStatus -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; RunStatus -&gt; m ()
</span><a href="IC.Ref.Types.html#setRunStatus"><span class="hs-identifier hs-var">setRunStatus</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331896"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">RunStatus
</span><a href="IC.Ref.Types.html#IsDeleted"><span class="hs-identifier hs-var">IsDeleted</span></a></span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span id="local-6989586621679334720"><span class="annot"><a href="IC.Ref.Management.html#icDepositCycles"><span class="hs-identifier hs-type">icDepositCycles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334720"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334720"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CallId"><span class="hs-identifier hs-type">CallId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334720"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;deposit_cycles&quot;</span></span></span><span>
</span><span id="line-351"></span><span id="icDepositCycles"><span class="annot"><span class="annottext">icDepositCycles :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
CallId -&gt; ICManagement m .! &quot;deposit_cycles&quot;
</span><a href="IC.Ref.Management.html#icDepositCycles"><span class="hs-identifier hs-var hs-var">icDepositCycles</span></a></span></span><span> </span><span id="local-6989586621679331857"><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679331857"><span class="hs-identifier hs-var">ctxt_id</span></a></span></span><span> </span><span id="local-6989586621679331856"><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331856"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679331855"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679331855"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331856"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;canister_id&quot; ':-&gt; Principal])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R '[ &quot;canister_id&quot; ':-&gt; Principal] .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679331890"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m ()
forall (m :: * -&gt; *). (CanReject m, ICM m) =&gt; EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#canisterMustExist"><span class="hs-identifier hs-var">canisterMustExist</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331855"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>    </span><span id="local-6989586621679331854"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331854"><span class="hs-identifier hs-var">cycles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CallId -&gt; m Natural
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; m Natural
</span><a href="IC.Ref.Types.html#getCallContextCycles"><span class="hs-identifier hs-var">getCallContextCycles</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679331857"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679331853"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331853"><span class="hs-identifier hs-var">available</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CallId -&gt; m Natural
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; m Natural
</span><a href="IC.Ref.Types.html#getCallContextCycles"><span class="hs-identifier hs-var">getCallContextCycles</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679331857"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><span class="annottext">CallId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; CallId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setCallContextCycles"><span class="hs-identifier hs-var">setCallContextCycles</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><a href="#local-6989586621679331857"><span class="hs-identifier hs-var">ctxt_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331853"><span class="hs-identifier hs-var">available</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331854"><span class="hs-identifier hs-var">cycles</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679331852"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331852"><span class="hs-identifier hs-var">prev_balance</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Natural
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m Natural
</span><a href="IC.Ref.Types.html#getBalance"><span class="hs-identifier hs-var">getBalance</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331855"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setBalance"><span class="hs-identifier hs-var">setBalance</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331855"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; m ()) -&gt; Natural -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331852"><span class="hs-identifier hs-var">prev_balance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331854"><span class="hs-identifier hs-var">cycles</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span id="local-6989586621679334718"><span class="annot"><a href="IC.Ref.Management.html#icTopUpCanister"><span class="hs-identifier hs-type">icTopUpCanister</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334718"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334718"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334718"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;provisional_top_up_canister&quot;</span></span></span><span>
</span><span id="line-362"></span><span id="icTopUpCanister"><span class="annot"><span class="annottext">icTopUpCanister :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
ICManagement m .! &quot;provisional_top_up_canister&quot;
</span><a href="IC.Ref.Management.html#icTopUpCanister"><span class="hs-identifier hs-var hs-var">icTopUpCanister</span></a></span></span><span> </span><span id="local-6989586621679331825"><span class="annot"><span class="annottext">Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331825"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679331824"><span class="annot"><span class="annottext">canister_id :: EntityId
</span><a href="#local-6989586621679331824"><span class="hs-identifier hs-var hs-var">canister_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Principal -&gt; EntityId
</span><a href="IC.Management.html#principalToEntityId"><span class="hs-identifier hs-var">principalToEntityId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331825"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
-&gt; Label &quot;canister_id&quot;
-&gt; 'R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal]
   .! &quot;canister_id&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;canister_id&quot; (Label &quot;canister_id&quot;)
Label &quot;canister_id&quot;
</span><a href="#local-6989586621679331848"><span class="hs-var">#canister_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m ()
forall (m :: * -&gt; *). (CanReject m, ICM m) =&gt; EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#canisterMustExist"><span class="hs-identifier hs-var">canisterMustExist</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331824"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621679331823"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331823"><span class="hs-identifier hs-var">prev_balance</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; m Natural
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; m Natural
</span><a href="IC.Ref.Types.html#getBalance"><span class="hs-identifier hs-var">getBalance</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331824"><span class="hs-identifier hs-var">canister_id</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; Natural -&gt; m ()
forall (m :: * -&gt; *). ICM m =&gt; EntityId -&gt; Natural -&gt; m ()
</span><a href="IC.Ref.Types.html#setBalance"><span class="hs-identifier hs-var">setBalance</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331824"><span class="hs-identifier hs-var">canister_id</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; m ()) -&gt; Natural -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679331823"><span class="hs-identifier hs-var">prev_balance</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
</span><a href="#local-6989586621679331825"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal])
-&gt; Label &quot;amount&quot;
-&gt; 'R '[ &quot;amount&quot; ':-&gt; Natural, &quot;canister_id&quot; ':-&gt; Principal]
   .! &quot;amount&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;amount&quot; (Label &quot;amount&quot;)
Label &quot;amount&quot;
</span><a href="#local-6989586621679331831"><span class="hs-var">#amount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span id="local-6989586621679334717"><span class="annot"><a href="IC.Ref.Management.html#icRawRand"><span class="hs-identifier hs-type">icRawRand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334717"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334717"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;raw_rand&quot;</span></span></span><span>
</span><span id="line-370"></span><span id="icRawRand"><span class="annot"><span class="annottext">icRawRand :: forall (m :: * -&gt; *). ICM m =&gt; ICManagement m .! &quot;raw_rand&quot;
</span><a href="IC.Ref.Management.html#icRawRand"><span class="hs-identifier hs-var hs-var">icRawRand</span></a></span></span><span> </span><span id="local-6989586621679331800"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621679331800"><span class="hs-identifier hs-var">_r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rand StdGen ByteString -&gt; m ByteString
forall (m :: * -&gt; *) a. ICM m =&gt; Rand StdGen a -&gt; m a
</span><a href="IC.Ref.Management.html#runRandIC"><span class="hs-identifier hs-var">runRandIC</span></a></span><span> </span><span class="annot"><span class="annottext">(Rand StdGen ByteString -&gt; m ByteString)
-&gt; Rand StdGen ByteString -&gt; m ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/bytestring-0.10.12.1/src/Data.ByteString.Lazy.html#pack"><span class="hs-identifier hs-var">BS.pack</span></a></span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; ByteString)
-&gt; RandT StdGen Identity [Word8] -&gt; Rand StdGen ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
-&gt; RandT StdGen Identity Word8 -&gt; RandT StdGen Identity [Word8]
forall (m :: * -&gt; *) a. Applicative m =&gt; CallId -&gt; m a -&gt; m [a]
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Control.Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">CallId
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">RandT StdGen Identity Word8
forall (m :: * -&gt; *) a. (MonadRandom m, Random a) =&gt; m a
</span><a href="file:///nix/store/b8ghyjizqjbnr6k9x8bbyvldavq0c2wf-MonadRandom-0.5.3-doc/share/doc/MonadRandom-0.5.3/html/src/Control.Monad.Random.Class.html#getRandom"><span class="hs-identifier hs-var">getRandom</span></a></span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span id="local-6989586621679334519"><span id="local-6989586621679334520"><span class="annot"><a href="IC.Ref.Management.html#runRandIC"><span class="hs-identifier hs-type">runRandIC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/b8ghyjizqjbnr6k9x8bbyvldavq0c2wf-MonadRandom-0.5.3-doc/share/doc/MonadRandom-0.5.3/html/src/Control.Monad.Trans.Random.Lazy.html#Rand"><span class="hs-identifier hs-type">Rand</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/iihaabbpcwx2aj17g6m30gcbs3i39cp3-random-1.2.1.1-doc/share/doc/random-1.2.1.1/html/src/System.Random.Internal.html#StdGen"><span class="hs-identifier hs-type">StdGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334519"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679334520"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334519"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-373"></span><span id="runRandIC"><span class="annot"><span class="annottext">runRandIC :: forall (m :: * -&gt; *) a. ICM m =&gt; Rand StdGen a -&gt; m a
</span><a href="IC.Ref.Management.html#runRandIC"><span class="hs-identifier hs-var hs-var">runRandIC</span></a></span></span><span> </span><span id="local-6989586621679331792"><span class="annot"><span class="annottext">Rand StdGen a
</span><a href="#local-6989586621679331792"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IC -&gt; (a, IC)) -&gt; m a
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; (a, s)) -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/mtl-2.2.2/src/Control.Monad.State.Class.html#state"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">((IC -&gt; (a, IC)) -&gt; m a) -&gt; (IC -&gt; (a, IC)) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679331790"><span class="annot"><span class="annottext">IC
</span><a href="#local-6989586621679331790"><span class="hs-identifier hs-var">ic</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679331789"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679331789"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679331788"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679331788"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rand StdGen a -&gt; StdGen -&gt; (a, StdGen)
forall g a. Rand g a -&gt; g -&gt; (a, g)
</span><a href="file:///nix/store/b8ghyjizqjbnr6k9x8bbyvldavq0c2wf-MonadRandom-0.5.3-doc/share/doc/MonadRandom-0.5.3/html/src/Control.Monad.Trans.Random.Lazy.html#runRand"><span class="hs-identifier hs-var">runRand</span></a></span><span> </span><span class="annot"><span class="annottext">Rand StdGen a
</span><a href="#local-6989586621679331792"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IC -&gt; StdGen
</span><a href="IC.Ref.Types.html#rng"><span class="hs-identifier hs-var hs-var">rng</span></a></span><span> </span><span class="annot"><span class="annottext">IC
</span><a href="#local-6989586621679331790"><span class="hs-identifier hs-var">ic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679331789"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IC
</span><a href="#local-6989586621679331790"><span class="hs-identifier hs-var">ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rng :: StdGen
</span><a href="IC.Ref.Types.html#rng"><span class="hs-identifier hs-var">rng</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679331788"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span id="local-6989586621679334714"><span class="annot"><a href="IC.Ref.Management.html#icEcdsaPublicKey"><span class="hs-identifier hs-type">icEcdsaPublicKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334714"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334714"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334714"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ecdsa_public_key&quot;</span></span></span><span>
</span><span id="line-378"></span><span id="icEcdsaPublicKey"><span class="annot"><span class="annottext">icEcdsaPublicKey :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId -&gt; ICManagement m .! &quot;ecdsa_public_key&quot;
</span><a href="IC.Ref.Management.html#icEcdsaPublicKey"><span class="hs-identifier hs-var hs-var">icEcdsaPublicKey</span></a></span></span><span> </span><span id="local-6989586621679331748"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331748"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span id="local-6989586621679331747"><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
        &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text])])
</span><a href="#local-6989586621679331747"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679331746"><span class="annot"><span class="annottext">cid :: EntityId
</span><a href="#local-6989586621679331746"><span class="hs-identifier hs-var hs-var">cid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityId
-&gt; Rec
     ('R
        '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
           &quot;derivation_path&quot; ':-&gt; Vector ByteString,
           &quot;key_id&quot;
           ':-&gt; Rec
                  ('R
                     '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                        &quot;name&quot; ':-&gt; Text])])
-&gt; EntityId
forall (r :: Row (*)).
((r .! &quot;canister_id&quot;) ~ Maybe Principal) =&gt;
EntityId -&gt; Rec r -&gt; EntityId
</span><a href="IC.Ref.Management.html#fetchCanisterIdfromMaybe"><span class="hs-identifier hs-var">fetchCanisterIdfromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331748"><span class="hs-identifier hs-var">caller</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
        &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text])])
</span><a href="#local-6989586621679331747"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><span class="annottext">EntityId -&gt; m ()
forall (m :: * -&gt; *). (CanReject m, ICM m) =&gt; EntityId -&gt; m ()
</span><a href="IC.Ref.Types.html#canisterMustExist"><span class="hs-identifier hs-var">canisterMustExist</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331746"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679331745"><span class="annot"><span class="annottext">key :: ExtendedSecretKey
</span><a href="#local-6989586621679331745"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; ExtendedSecretKey
</span><a href="IC.Ref.Types.html#getCanisterRootKey"><span class="hs-identifier hs-var">getCanisterRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331746"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtendedSecretKey -&gt; Vector ByteString -&gt; Either MethodName XPubKey
</span><a href="IC.Crypto.Bitcoin.html#derivePublicKey"><span class="hs-identifier hs-var">Bitcoin.derivePublicKey</span></a></span><span> </span><span class="annot"><span class="annottext">ExtendedSecretKey
</span><a href="#local-6989586621679331745"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
        &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text])])
</span><a href="#local-6989586621679331747"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
        &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text])])
-&gt; Label &quot;derivation_path&quot;
-&gt; 'R
     '[ &quot;canister_id&quot; ':-&gt; Maybe Principal,
        &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text])]
   .! &quot;derivation_path&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;derivation_path&quot; (Label &quot;derivation_path&quot;)
Label &quot;derivation_path&quot;
</span><a href="#local-6989586621679331772"><span class="hs-var">#derivation_path</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-383"></span><span>      </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679331742"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679331742"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode
-&gt; MethodName
-&gt; Maybe ErrorCode
-&gt; m (Rec
        ('R
           '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString]))
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679331742"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_INVALID_ENCODING"><span class="hs-identifier hs-var">EC_INVALID_ENCODING</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679331741"><span class="annot"><span class="annottext">XPubKey
</span><a href="#local-6989586621679331741"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Rec
  ('R '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])
-&gt; m (Rec
        ('R
           '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec
   ('R '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])
 -&gt; m (Rec
         ('R
            '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])))
-&gt; Rec
     ('R '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString])
-&gt; m (Rec
        ('R
           '[ &quot;chain_code&quot; ':-&gt; ByteString, &quot;public_key&quot; ':-&gt; ByteString]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[])
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#empty"><span class="hs-identifier hs-var">R.empty</span></a></span><span>
</span><span id="line-385"></span><span>                   </span><span class="annot"><span class="annottext">Rec ('R '[])
-&gt; Rec ('R '[ &quot;public_key&quot; ':-&gt; ByteString])
-&gt; Rec ('R '[] .+ 'R '[ &quot;public_key&quot; ':-&gt; ByteString])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;public_key&quot; (Label &quot;public_key&quot;)
Label &quot;public_key&quot;
</span><a href="#local-6989586621679331760"><span class="hs-var">#public_key</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;public_key&quot;
-&gt; ByteString -&gt; Rec (Extend &quot;public_key&quot; ByteString ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPubKey -&gt; ByteString
</span><a href="IC.Crypto.Bitcoin.html#publicKeyToDER"><span class="hs-identifier hs-var">publicKeyToDER</span></a></span><span> </span><span class="annot"><span class="annottext">XPubKey
</span><a href="#local-6989586621679331741"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>                   </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;public_key&quot; ':-&gt; ByteString])
-&gt; Rec ('R '[ &quot;chain_code&quot; ':-&gt; ByteString])
-&gt; Rec
     ('R '[ &quot;public_key&quot; ':-&gt; ByteString]
      .+ 'R '[ &quot;chain_code&quot; ':-&gt; ByteString])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;chain_code&quot; (Label &quot;chain_code&quot;)
Label &quot;chain_code&quot;
</span><a href="#local-6989586621679331757"><span class="hs-var">#chain_code</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;chain_code&quot;
-&gt; ByteString -&gt; Rec (&quot;chain_code&quot; .== ByteString)
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPubKey -&gt; ByteString
</span><a href="IC.Crypto.Bitcoin.html#extractChainCode"><span class="hs-identifier hs-var">extractChainCode</span></a></span><span> </span><span class="annot"><span class="annottext">XPubKey
</span><a href="#local-6989586621679331741"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span id="local-6989586621679334713"><span class="annot"><a href="IC.Ref.Management.html#icSignWithEcdsa"><span class="hs-identifier hs-type">icSignWithEcdsa</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IC.Ref.Types.html#ICM"><span class="hs-identifier hs-type">ICM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334713"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="IC.Ref.Types.html#CanReject"><span class="hs-identifier hs-type">CanReject</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334713"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="IC.Types.html#EntityId"><span class="hs-identifier hs-type">EntityId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IC.Management.html#ICManagement"><span class="hs-identifier hs-type">ICManagement</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679334713"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Internal.html#.%21"><span class="hs-operator hs-type">.!</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;sign_with_ecdsa&quot;</span></span></span><span>
</span><span id="line-389"></span><span id="icSignWithEcdsa"><span class="annot"><span class="annottext">icSignWithEcdsa :: forall (m :: * -&gt; *).
(ICM m, CanReject m) =&gt;
EntityId -&gt; ICManagement m .! &quot;sign_with_ecdsa&quot;
</span><a href="IC.Ref.Management.html#icSignWithEcdsa"><span class="hs-identifier hs-var hs-var">icSignWithEcdsa</span></a></span></span><span> </span><span id="local-6989586621679331721"><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331721"><span class="hs-identifier hs-var">caller</span></a></span></span><span> </span><span id="local-6989586621679331720"><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text]),
        &quot;message_hash&quot; ':-&gt; ByteString])
</span><a href="#local-6989586621679331720"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679331719"><span class="annot"><span class="annottext">key :: ExtendedSecretKey
</span><a href="#local-6989586621679331719"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EntityId -&gt; ExtendedSecretKey
</span><a href="IC.Ref.Types.html#getCanisterRootKey"><span class="hs-identifier hs-var">getCanisterRootKey</span></a></span><span> </span><span class="annot"><span class="annottext">EntityId
</span><a href="#local-6989586621679331721"><span class="hs-identifier hs-var">caller</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ExtendedSecretKey -&gt; Vector ByteString -&gt; Either MethodName XPrvKey
</span><a href="IC.Crypto.Bitcoin.html#derivePrivateKey"><span class="hs-identifier hs-var">Bitcoin.derivePrivateKey</span></a></span><span> </span><span class="annot"><span class="annottext">ExtendedSecretKey
</span><a href="#local-6989586621679331719"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text]),
        &quot;message_hash&quot; ':-&gt; ByteString])
</span><a href="#local-6989586621679331720"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text]),
        &quot;message_hash&quot; ':-&gt; ByteString])
-&gt; Label &quot;derivation_path&quot;
-&gt; 'R
     '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text]),
        &quot;message_hash&quot; ':-&gt; ByteString]
   .! &quot;derivation_path&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;derivation_path&quot; (Label &quot;derivation_path&quot;)
Label &quot;derivation_path&quot;
</span><a href="#local-6989586621679331735"><span class="hs-var">#derivation_path</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-392"></span><span>      </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679331717"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679331717"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode
-&gt; MethodName
-&gt; Maybe ErrorCode
-&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString]))
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679331717"><span class="hs-identifier hs-var">err</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_INVALID_ENCODING"><span class="hs-identifier hs-var">EC_INVALID_ENCODING</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>      </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679331716"><span class="annot"><span class="annottext">XPrvKey
</span><a href="#local-6989586621679331716"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either MethodName Hash256
</span><a href="IC.Crypto.Bitcoin.html#toHash256"><span class="hs-identifier hs-var">Bitcoin.toHash256</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text]),
        &quot;message_hash&quot; ':-&gt; ByteString])
</span><a href="#local-6989586621679331720"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rec
  ('R
     '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text]),
        &quot;message_hash&quot; ':-&gt; ByteString])
-&gt; Label &quot;message_hash&quot;
-&gt; 'R
     '[ &quot;derivation_path&quot; ':-&gt; Vector ByteString,
        &quot;key_id&quot;
        ':-&gt; Rec
               ('R
                  '[ &quot;curve&quot; ':-&gt; Var ('R '[ &quot;secp256k1&quot; ':-&gt; ()]),
                     &quot;name&quot; ':-&gt; Text]),
        &quot;message_hash&quot; ':-&gt; ByteString]
   .! &quot;message_hash&quot;
forall (l :: Symbol) (r :: Row (*)).
KnownSymbol l =&gt;
Rec r -&gt; Label l -&gt; r .! l
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%21"><span class="hs-operator hs-var">.!</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;message_hash&quot; (Label &quot;message_hash&quot;)
Label &quot;message_hash&quot;
</span><a href="#local-6989586621679331731"><span class="hs-var">#message_hash</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-395"></span><span>          </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679331714"><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679331714"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RejectCode
-&gt; MethodName
-&gt; Maybe ErrorCode
-&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString]))
forall (m :: * -&gt; *) a2.
CanReject m =&gt;
RejectCode -&gt; MethodName -&gt; Maybe ErrorCode -&gt; m a2
</span><a href="IC.Ref.Types.html#reject"><span class="hs-identifier hs-var">reject</span></a></span><span> </span><span class="annot"><span class="annottext">RejectCode
</span><a href="IC.Types.html#RC_CANISTER_ERROR"><span class="hs-identifier hs-var">RC_CANISTER_ERROR</span></a></span><span> </span><span class="annot"><span class="annottext">MethodName
</span><a href="#local-6989586621679331714"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorCode -&gt; Maybe ErrorCode
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCode
</span><a href="IC.Types.html#EC_INVALID_ENCODING"><span class="hs-identifier hs-var">EC_INVALID_ENCODING</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>          </span><span class="annot"><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679331713"><span class="annot"><span class="annottext">Hash256
</span><a href="#local-6989586621679331713"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>            </span><span class="annot"><span class="annottext">Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])
-&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])
 -&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])))
-&gt; Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])
-&gt; m (Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/sq3hm1arb77zb833mld18fi4liydbf18-ghc-9.0.2-doc/share/doc/ghc/html/libraries/base-4.15.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Rec ('R '[])
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#empty"><span class="hs-identifier hs-var">R.empty</span></a></span><span>
</span><span id="line-398"></span><span>              </span><span class="annot"><span class="annottext">Rec ('R '[])
-&gt; Rec ('R '[ &quot;signature&quot; ':-&gt; ByteString])
-&gt; Rec ('R '[] .+ 'R '[ &quot;signature&quot; ':-&gt; ByteString])
forall (l :: Row (*)) (r :: Row (*)).
FreeForall l =&gt;
Rec l -&gt; Rec r -&gt; Rec (l .+ r)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%2B"><span class="hs-operator hs-var">.+</span></a></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;signature&quot; (Label &quot;signature&quot;)
Label &quot;signature&quot;
</span><a href="#local-6989586621679331724"><span class="hs-var">#signature</span></a></span><span> </span><span class="annot"><span class="annottext">Label &quot;signature&quot;
-&gt; ByteString -&gt; Rec (Extend &quot;signature&quot; ByteString ('R '[]))
forall (l :: Symbol) a.
KnownSymbol l =&gt;
Label l -&gt; a -&gt; Rec (l .== a)
</span><a href="file:///nix/store/b588wzszvp5fnvv6rhlb8hcvmljsxf2h-row-types-1.0.1.2-doc/share/doc/row-types-1.0.1.2/html/src/Data.Row.Records.html#.%3D%3D"><span class="hs-operator hs-var">.==</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPrvKey -&gt; Hash256 -&gt; ByteString
</span><a href="IC.Crypto.Bitcoin.html#sign"><span class="hs-identifier hs-var">Bitcoin.sign</span></a></span><span> </span><span class="annot"><span class="annottext">XPrvKey
</span><a href="#local-6989586621679331716"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Hash256
</span><a href="#local-6989586621679331713"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span></pre></body></html>